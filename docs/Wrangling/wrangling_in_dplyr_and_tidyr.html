<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title> | STV4030A - Wrangling in dplyr and tidyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Wrangling/tidy_data.html" rel="prev">
<link href="..//pics/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title"><img src="..\pics/uio-logo-white.png" class="img-fluid" width="150"> | STV4030A</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Wrangling/tidy_data.html">Data Wrangling</a></li><li class="breadcrumb-item"><a href="../Wrangling/wrangling_in_dplyr_and_tidyr.html">Wrangling in <code>dplyr</code> and <code>tidyr</code></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.uio.no/oyvinsti/STV4030A">
            Source code
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.uio.no/oyvinsti/STV4030A/issues">
            Report an error
            </a>
          </li>
      </ul>
    </div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Working in R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/R_refresher.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R refresher</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/Beyond_the_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Beyond the basics: functions and iteration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/Functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writing your own functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/Iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Iteration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/encoding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Locales and encoding</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Quarto documents</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Quarto_documents/writing_quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writing Quarto documents</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Quarto_documents/producing_tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Producing Tables from R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Wrangling/tidy_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidy Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Wrangling/wrangling_in_dplyr_and_tidyr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Wrangling in <code>dplyr</code> and <code>tidyr</code></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Visualization/data_viz_in_ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Visualization in <code>ggplot2</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Visualization/data_viz_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Examples of different types of data visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Visualization/data_viz_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualizing regression models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Visualization/data_viz_model_predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualizing quantities of interest based on regression models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Text data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/text_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Political Text as Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/read_texts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reading Texts into R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regular expressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/extracting_data_from_texts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extracting data from texts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preprocessing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Data gathering</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_gather/webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Webscraping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_gather/apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">APIs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Spatial data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial_data/what_is_spatial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What is spatial data?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial_data/reading_spatial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reading spatial data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial_data/spatial_joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial joins</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial_data/basic_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating maps</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#manipulating-data-with-dplyr" id="toc-manipulating-data-with-dplyr" class="nav-link active" data-scroll-target="#manipulating-data-with-dplyr">Manipulating data with <code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><code>filter()</code></a></li>
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><code>select()</code></a></li>
  <li><a href="#rename" id="toc-rename" class="nav-link" data-scroll-target="#rename"><code>rename()</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><code>mutate()</code></a>
  <ul class="collapse">
  <li><a href="#coding-variables-based-on-multiple-logical-conditions-using-case_when" id="toc-coding-variables-based-on-multiple-logical-conditions-using-case_when" class="nav-link" data-scroll-target="#coding-variables-based-on-multiple-logical-conditions-using-case_when">Coding variables based on multiple logical conditions using <code>case_when()</code></a></li>
  </ul></li>
  <li><a href="#using-pipes" id="toc-using-pipes" class="nav-link" data-scroll-target="#using-pipes">Using pipes (<code>%&gt;%</code>)</a></li>
  <li><a href="#grouping-data-using-group_by" id="toc-grouping-data-using-group_by" class="nav-link" data-scroll-target="#grouping-data-using-group_by">Grouping data using <code>group_by()</code></a></li>
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize"><code>summarize()</code></a></li>
  <li><a href="#mutate-or-summarize-across-multiple-columns" id="toc-mutate-or-summarize-across-multiple-columns" class="nav-link" data-scroll-target="#mutate-or-summarize-across-multiple-columns"><code>mutate()</code> or <code>summarize()</code> <code>across()</code> multiple columns</a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><code>arrange()</code></a></li>
  <li><a href="#distinct" id="toc-distinct" class="nav-link" data-scroll-target="#distinct"><code>distinct()</code></a></li>
  </ul></li>
  <li><a href="#combining-datasets-with-dplyr" id="toc-combining-datasets-with-dplyr" class="nav-link" data-scroll-target="#combining-datasets-with-dplyr">Combining datasets with <code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#joining-also-called-merging-data" id="toc-joining-also-called-merging-data" class="nav-link" data-scroll-target="#joining-also-called-merging-data">Joining (also called “merging”) data</a>
  <ul class="collapse">
  <li><a href="#left_join" id="toc-left_join" class="nav-link" data-scroll-target="#left_join"><code>left_join()</code></a></li>
  <li><a href="#inner_join" id="toc-inner_join" class="nav-link" data-scroll-target="#inner_join"><code>inner_join()</code></a></li>
  <li><a href="#full_join" id="toc-full_join" class="nav-link" data-scroll-target="#full_join"><code>full_join()</code></a></li>
  </ul></li>
  <li><a href="#binding-data" id="toc-binding-data" class="nav-link" data-scroll-target="#binding-data">Binding data</a>
  <ul class="collapse">
  <li><a href="#bind_rows" id="toc-bind_rows" class="nav-link" data-scroll-target="#bind_rows"><code>bind_rows()</code></a></li>
  <li><a href="#bind_cols" id="toc-bind_cols" class="nav-link" data-scroll-target="#bind_cols"><code>bind_cols()</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#changing-the-structure-of-datasets-with-tidyr" id="toc-changing-the-structure-of-datasets-with-tidyr" class="nav-link" data-scroll-target="#changing-the-structure-of-datasets-with-tidyr">Changing the structure of datasets with <code>tidyr</code></a></li>
  <li><a href="#unite-and-separate" id="toc-unite-and-separate" class="nav-link" data-scroll-target="#unite-and-separate"><code>unite()</code> and <code>separate()</code></a>
  <ul class="collapse">
  <li><a href="#unite" id="toc-unite" class="nav-link" data-scroll-target="#unite"><code>unite()</code></a></li>
  <li><a href="#separate" id="toc-separate" class="nav-link" data-scroll-target="#separate"><code>separate()</code></a>
  <ul class="collapse">
  <li><a href="#separate-when-the-number-of-values-differ-between-rows" id="toc-separate-when-the-number-of-values-differ-between-rows" class="nav-link" data-scroll-target="#separate-when-the-number-of-values-differ-between-rows"><code>separate()</code> when the number of values differ between rows</a></li>
  </ul></li>
  <li><a href="#separate_longer_delim" id="toc-separate_longer_delim" class="nav-link" data-scroll-target="#separate_longer_delim"><code>separate_longer_delim()</code></a></li>
  </ul></li>
  <li><a href="#pivoting-also-called-reshaping-your-data" id="toc-pivoting-also-called-reshaping-your-data" class="nav-link" data-scroll-target="#pivoting-also-called-reshaping-your-data">Pivoting (also called “reshaping”) your data</a>
  <ul class="collapse">
  <li><a href="#pivot_longer" id="toc-pivot_longer" class="nav-link" data-scroll-target="#pivot_longer"><code>pivot_longer()</code></a></li>
  <li><a href="#pivot_wider" id="toc-pivot_wider" class="nav-link" data-scroll-target="#pivot_wider"><code>pivot_wider()</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Wrangling in <code>dplyr</code> and <code>tidyr</code></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>We now turn to how you can <em>tidy</em> your data so that each observation is a row, each variable is a column, and each value is a cell and how you can <em>transform</em> or <em>manipulate</em> your dataset so that it contains exactly the information you need for your analysis, for instance by subsetting to a particular set of observations or recoding some of the variables. We will refer to these tasks as <em>data wrangling</em>.</p>
<p>Wrangling is a fundamental part of quantitative political science! If we cannot get our data in the right format, we cannot do our advanced statistical analyses or make our beautiful visualizations.</p>
<p>For our data wrangling we will rely heavily on the <code>dplyr</code> and <code>tidyr</code> packages (both part of the so-called <code>tidyverse</code>). While <code>tidyr</code> contains a set of functions for making dataset tidy (for instance by pivoting/reshaping them), <code>dplyr</code> contains a set of functions for manipulating data (for instance by filtering observations or recoding variables).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>tidyverse</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>tidyverse</code> is a collection of R packages that share a common preference for tidy data and particular style of writing R code. We find the <code>tidyverse</code> packages extremely useful!</p>
<p><code>dplyr</code> and <code>tidyr</code> are both part of <code>tidyverse</code>, as are <code>haven</code> and <code>readr</code> which we already used to load data, <code>purrr</code> which have used for iteration, <code>ggplot2</code> which we will use for data visualization, and <code>stringr</code> which we will use for working with text data. There are also several other useful packages in the <code>tidyverse</code>. You can install all the packages in <code>tidyverse</code> in one go by running:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While <code>install.packages("tidyverse")</code> installs the entire <code>tidyverse</code>, the following command will load the nine most frequently used <code>tidyverse</code> packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The packages loaded by <code>library(tidyverse)</code> are <code>dplyr</code>, <code>tidyr</code>, <code>forcats</code>, <code>ggplot2</code>, <code>lubridate</code>, <code>purrr</code>, <code>readr</code>, <code>stringr</code>, and <code>tibble</code>.</p>
<p>You can learn more about the <code>tidyverse</code> <a href="https://www.tidyverse.org/">here</a> or in <a href="https://r4ds.had.co.nz/"><span class="citation" data-cites="wickham2023r">Wickham, Çetinkaya-Rundel, and Grolemund (<span>2023</span>)</span></a>.</p>
</div>
</div>
<p>Before we go in detail on the various wrangling functions, the following two videos provide an overview of functions we will often be using:</p>
<iframe src="https://uio.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=ca06a0ab-a0e7-431c-89ec-b031014047af&amp;autoplay=false&amp;offerviewer=true&amp;showtitle=true&amp;showbrand=true&amp;captions=true&amp;interactivity=all" height="405" width="720" style="border: 1px solid #464646;" allowfullscreen="" allow="autoplay">
</iframe>
<iframe src="https://uio.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=e023e158-c5fe-4ab4-9de1-b03101404787&amp;autoplay=false&amp;offerviewer=true&amp;showtitle=true&amp;showbrand=true&amp;captions=false&amp;interactivity=all" height="405" width="720" style="border: 1px solid #464646;" allowfullscreen="" allow="autoplay">
</iframe>
<p>Now that we have a sense of what some of the frequently used wrangling functions are, we will go in more detail in text and code.</p>
<p>Let’s start by introducing some of the <code>dplyr</code> functions for manipulating data. Even when our dataset already is in a “tidy” format, many of these functions will be useful to further manipulate the data to suit our particular research needs!</p>
<section id="manipulating-data-with-dplyr" class="level1">
<h1>Manipulating data with <code>dplyr</code></h1>
<p>As explained in the above video, <code>dplyr</code> contains set of “verbs” that do something to our dataset. For instance <code>filter()</code> is a verb that “filters” the data to only contain specific rows, while <code>select()</code> is a verb that “selects” columns from the dataset. Pipes (<code>%&gt;%</code>) allow us to combine multiple operations on our dataset together (which makes our code much easier to read).</p>
<section id="filter" class="level2">
<h2 class="anchored" data-anchor-id="filter"><code>filter()</code></h2>
<p>Let’s revisit the WhoGov dataset by <span class="citation" data-cites="nyrup2020governs">Nyrup and Bramwell (<a href="#ref-nyrup2020governs" role="doc-biblioref">2020</a>)</span>, which we introduced <a href="https://pages.github.uio.no/oyvinsti/STV4030A/basics_refresh/R_refresher.html#sec-loading-data">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>who_gov <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"../data/WhoGov_within_V2.0.csv"</span>, <span class="at">delim =</span> <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Suppose we are only interested in observations from Norway. If so, we want to <code>filter()</code> the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-2-1"><a href="#annotated-cell-2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-2" class="code-annotation-target"><a href="#annotated-cell-2-2" aria-hidden="true" tabindex="-1"></a>who_gov_norway <span class="ot">&lt;-</span> <span class="fu">filter</span>(who_gov,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-2-3" class="code-annotation-target"><a href="#annotated-cell-2-3" aria-hidden="true" tabindex="-1"></a>                         country_isocode <span class="sc">==</span> <span class="st">"NOR"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="2" data-code-annotation="1">The first argument is the name of a <code>data.frame</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="3" data-code-annotation="2">The second argument is some condition that we use to <code>filter()</code> the data. Here the condition is that we only want observations for which <code>country_isocode == "NOR"</code> evaluates to <code>TRUE</code>.</span>
</dd>
</dl>
</div>
</div>
<p>Suppose that we are also only interested in ministers and would like to remove other types of people also included in the dataset (we definitely don’t care about the kings!). The variable called <code>classification</code> contains a standardized classification of the different positions people in the dataset held (the <a href="https://static.cambridge.org/content/id/urn:cambridge.org:id:article:S0003055420000490/resource/name/S0003055420000490sup001.pdf">codebook</a> says so!).</p>
<p>Using <code>table()</code> we can figure out how the Norwegian observations are classified:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(who_gov_norway<span class="sc">$</span>classification)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Ambassador to the United States                Deputy Prime Minister 
                                  29                                    2 
             Governor (Central Bank)                 Member, Royal Family 
                                  36                                   56 
                Minister (Full Rank)                       Prime Minister 
                                 958                                   56 
Representative to the United Nations 
                                  26 </code></pre>
</div>
</div>
<p>If we are interested in ministers, we want all the observations with the value “Prime Minister” or the value “Minister (Full Rank)” on the variable <code>who_gov_norway$classification</code>. Again, we can <code>filter()</code> the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> <span class="fu">filter</span>(who_gov_norway, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-4-2" class="code-annotation-target"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a>                        classification <span class="sc">==</span> <span class="st">"Prime Minister"</span> <span class="sc">|</span></span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>                          classification <span class="sc">==</span> <span class="st">"Minister (Full Rank)"</span> )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="2,3" data-code-annotation="1">We use the “or” operator “<code>|</code>” to filter the data so that observations need to either have the value “Prime Minister” or the value “Minister (Full Rank)” on the variable <code>who_gov_norway$classification</code> to be included in our filtered dataset.</span>
</dd>
</dl>
</div>
</div>
<p>We could also have combined these two conditions in one call to <code>filter()</code> using <code>,</code> to separate between different conditions that filtered observations need to satisfy:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-5-1" class="code-annotation-target"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> <span class="fu">filter</span>(who_gov,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-5-2" class="code-annotation-target"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a>                                   country_isocode <span class="sc">==</span> <span class="st">"NOR"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-5-3" class="code-annotation-target"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a>                        classification <span class="sc">==</span> <span class="st">"Prime Minister"</span> <span class="sc">|</span></span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a>                          classification <span class="sc">==</span> <span class="st">"Minister (Full Rank)"</span>) </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="1" data-code-annotation="1">We are starting with the full <code>who_gov</code> <code>data.frame</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="2" data-code-annotation="2">We filter observations for which <code>country_isocode == "NOR"</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="3" data-code-annotation="3">And we filter observations for which either <code>classification == "Prime Minister"</code> or <code>classification == "Minister (Full Rank)"</code> evaluate to <code>TRUE</code>.</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="select" class="level2">
<h2 class="anchored" data-anchor-id="select"><code>select()</code></h2>
<p>While <code>filter()</code> filters the observations in the dataset, <code>select()</code> selects specific columns in the dataset.</p>
<p>Suppose we only want the variables “year”,“country_isocode”, “id”, “position”, “name”, “gender”, “birthyear”, “deadyear”, “party”, and “classification”. If so, we can <code>select()</code> these columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-6"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-6-1" class="code-annotation-target"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span>  <span class="fu">select</span>(who_gov_norway_ministers,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-6-2" class="code-annotation-target"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a>                                    year,country_isocode, id, position, name,</span>
<span id="annotated-cell-6-3"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a>                                    gender,  birthyear, deadyear, party, classification)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="1" data-code-annotation="1">We start with <code>who_gov_norway_ministers</code> and here we will also overwrite the existing <code>who_gov_norway_ministers</code> rather than assigning the result to a new object</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="2,3" data-code-annotation="2">We select the variables we would like to keep.</span>
</dd>
</dl>
</div>
</div>
<p>We may also use <code>select()</code> to remove variables. To remove variables we simply add a minus sign before the variable names. Perhaps we figure out that we don’t need the <code>country_isocode</code> variable as all the observations are from Norway. If so, we can:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a> who_gov_norway_ministers <span class="ot">&lt;-</span> <span class="fu">select</span>(who_gov_norway_ministers, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-7-2" class="code-annotation-target"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="sc">-</span>country_isocode)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="2" data-code-annotation="1">Removing the “country_isocode variable by putting a <code>-</code> in front of it in the <code>select()</code> code.</span>
</dd>
</dl>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
helper functions for <code>select()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sometimes we need to select many columns according to some rule or condition. There are multiple helper functions for such cases. Consider all the variables in the <code>who_gov</code> dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(who_gov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "...1"                "year"                "country_isocode"    
 [4] "country_name"        "id"                  "position"           
 [7] "name"                "title"               "gender"             
[10] "birthyear"           "deadyear"            "party"              
[13] "party_english"       "party_otherlanguage" "whogov_partyid"     
[16] "partyfacts_id"       "core"                "minister"           
[19] "leader"              "classification"      "portfolio_1"        
[22] "prestige_1"          "portfolio_2"         "prestige_2"         
[25] "portfolio_3"         "prestige_3"          "portfolio_4"        
[28] "prestige_4"          "m_finance"           "m_defense"          
[31] "m_agriculture"       "m_foreignaffairs"   </code></pre>
</div>
</div>
<p>Suppose for instance, that we want to select all the columns with names that start with “portfolio”. If so, we can use the helper function <code>starts_with()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>portfolios <span class="ot">&lt;-</span> <span class="fu">select</span>(who_gov, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">starts_with</span>(<span class="st">"portfolio"</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(portfolios)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "portfolio_1" "portfolio_2" "portfolio_3" "portfolio_4"</code></pre>
</div>
</div>
<p>Most likely, we don’t want a <code>data.frame</code> with only the <code>portfolios</code>. We would likely also keep the “name” and “year” of the observation and maybe we also want all the variables with “party” somewhere in the variable name. If so, we could run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>portfolios_and_party <span class="ot">&lt;-</span> <span class="fu">select</span>(who_gov, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                     name, year, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">starts_with</span>(<span class="st">"portfolio"</span>), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">contains</span>(<span class="st">"party"</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(portfolios_and_party)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "name"                "year"                "portfolio_1"        
 [4] "portfolio_2"         "portfolio_3"         "portfolio_4"        
 [7] "party"               "party_english"       "party_otherlanguage"
[10] "whogov_partyid"      "partyfacts_id"      </code></pre>
</div>
</div>
<p>There are multiple other helper functions. For an overview, you can run the following line in your console:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>?tidyr_tidy_select</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="rename" class="level2">
<h2 class="anchored" data-anchor-id="rename"><code>rename()</code></h2>
<p>It is straightforward to <code>rename()</code> variables.</p>
<p>Suppose we find the variable name “classification” to not really be that informative now that it only takes the values “Minister (Full Rank)” and “Prime Minister”.</p>
<p>Perhaps we want to <code>rename()</code> it as “minister_type”. If so we can run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-8"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-8-1"><a href="#annotated-cell-8-1" aria-hidden="true" tabindex="-1"></a> who_gov_norway_ministers <span class="ot">&lt;-</span> <span class="fu">rename</span>(who_gov_norway_ministers, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-8-2" class="code-annotation-target"><a href="#annotated-cell-8-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">minister_type =</span> classification)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="2" data-code-annotation="1">We need to specify <code>new_name = old_name</code> to <code>rename()</code> a variable.</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="mutate" class="level2">
<h2 class="anchored" data-anchor-id="mutate"><code>mutate()</code></h2>
<p>We can add new variables (or recode existing ones) using <code>mutate()</code>. For instance, we can create a variable measuring the age of each minister like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> <span class="fu">mutate</span>(who_gov_norway_ministers, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-9-2" class="code-annotation-target"><a href="#annotated-cell-9-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">age =</span> year <span class="sc">-</span> birthyear)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="2" data-code-annotation="1">We create a new variable called <code>age</code> which is <code>year</code> minus <code>birthyear</code>.</span>
</dd>
</dl>
</div>
</div>
<p>So, basically you need to supply the name of the new variable followed by the <code>=</code> sign and then you specify how this new variable should be created.</p>
<p>If the new variable name is the same as an existing variable name, the existing variable will be replaced by the new variable you are creating.</p>
<p>You can use various R functions to create the new variables. For instance, we will often use the <code>ifelse()</code> function (<a href="https://pages.github.uio.no/oyvinsti/STV4030A/basics_refresh/R_refresher.html#changing-or-adding-variables">which we introduced here</a>).</p>
<p>If we inspect the <code>who_gov_norway_ministers</code> carefully, we notice that there is a minister of fisheries and a minister of agriculture which both have missing values on multiple variables including on <code>birthyear</code> and who have the value “unknown” on the variable <code>party</code>. Using <code>filter()</code> we can print out these rows to the console:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(who_gov_norway_ministers, party <span class="sc">==</span> <span class="st">"unknown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 10
   year    id position name  gender birthyear deadyear party minister_type   age
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;
1  1968    41 Min. Of… Moyn… Unkno…        NA &lt;NA&gt;     unkn… Minister (Fu…    NA
2  1969    57 Min. Of… Moyn… Unkno…        NA &lt;NA&gt;     unkn… Minister (Fu…    NA
3  1970    73 Min. Of… Moyn… Unkno…        NA &lt;NA&gt;     unkn… Minister (Fu…    NA
4  1998   600 Min. Of… Kare… Male          NA &lt;NA&gt;     unkn… Minister (Fu…    NA
5  1999   624 Min. Of… Kare… Male          NA &lt;NA&gt;     unkn… Minister (Fu…    NA</code></pre>
</div>
</div>
<p>As political scientists trained in Norway we do know our ministers of fisheries<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and we certainly don’t recognize this “Moynes Einsi” who supposedly was minister of fisheries from 1968 to 1970. <a href="https://no.wikipedia.org/wiki/Einar_Moxnes">Einar Hole Moxnes</a> was, however, minister of fisheries in the that period and we will use <code>mutate()</code> and <code>ifelse()</code> to recode these three observations with data on him:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-11-1"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> <span class="fu">mutate</span>(who_gov_norway_ministers, </span>
<span id="annotated-cell-11-2"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">name =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Moynes Einsi"</span>, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-11-3" class="code-annotation-target"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"Einar Hole Moxnes"</span>, name ),</span>
<span id="annotated-cell-11-4"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">party =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span>, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-11-5" class="code-annotation-target"><a href="#annotated-cell-11-5" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"sp"</span>, party),</span>
<span id="annotated-cell-11-6"><a href="#annotated-cell-11-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">birthyear =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span>, </span>
<span id="annotated-cell-11-7"><a href="#annotated-cell-11-7" aria-hidden="true" tabindex="-1"></a>                                                       <span class="dv">1921</span>, birthyear),</span>
<span id="annotated-cell-11-8"><a href="#annotated-cell-11-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">deadyear =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span>, </span>
<span id="annotated-cell-11-9"><a href="#annotated-cell-11-9" aria-hidden="true" tabindex="-1"></a>                                                     <span class="dv">2006</span>,deadyear),</span>
<span id="annotated-cell-11-10"><a href="#annotated-cell-11-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">gender =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span>, </span>
<span id="annotated-cell-11-11"><a href="#annotated-cell-11-11" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Male"</span>, gender ),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-11-12" class="code-annotation-target"><a href="#annotated-cell-11-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">age =</span> year <span class="sc">-</span> birthyear)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="3" data-code-annotation="1">If the <code>name</code> is “Moynes Einsi”, we replace it with “Einar Hole Moxnes”, otherwise we keep what is stored in <code>name</code></span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="5,7,9,11" data-code-annotation="2">We recode the different variables for observations for which the <code>name</code> is (now) “Einar Hole Moxnes” and keep the other variables as they currently.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="12" data-code-annotation="3">If we calculate the <code>age</code> after the operations above, we avoid the missing value on <code>age</code> for “Einar Hole Moxnes”.</span>
</dd>
</dl>
</div>
</div>
<p>We similarly quickly realize that Kare Gennes should probably be <a href="https://en.wikipedia.org/wiki/K%C3%A5re_Gj%C3%B8nnes">Kåre Gjønnes</a> who represented Kristelig Folkeparti. We correct these two observations as well (his gender was already coded correctly):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> <span class="fu">mutate</span>(who_gov_norway_ministers, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">name =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Kare Gennes"</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"Kare Gjonnes"</span>, name ), </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">party =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Kare Gjonnes"</span>, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"krf"</span>, party), </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">birthyear =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Kare Gjonnes"</span>, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                                       <span class="dv">1942</span>, birthyear), </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">deadyear =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Kare Gjonnes"</span>, </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                                     <span class="dv">2021</span>,deadyear),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">age =</span> year <span class="sc">-</span> birthyear) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="coding-variables-based-on-multiple-logical-conditions-using-case_when" class="level3">
<h3 class="anchored" data-anchor-id="coding-variables-based-on-multiple-logical-conditions-using-case_when">Coding variables based on multiple logical conditions using <code>case_when()</code></h3>
<p>We will often find ourselves creating or recoding variables based on multiple logical conditions. Suppose, for instance, that we wanted a categorical age variable with the values “30-39 years”, “40-49 years”, “50-59 years”, “60-69 years”.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>There are different ways in which we could create such a variable. In the past we have frequently relied on combining multiple <code>ifelse()</code> calls. We could write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> <span class="fu">mutate</span>(who_gov_norway_ministers, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-13-2" class="code-annotation-target"><a href="#annotated-cell-13-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">age_categorical =</span> <span class="cn">NA</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-13-3" class="code-annotation-target"><a href="#annotated-cell-13-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">age_categorical =</span> <span class="fu">ifelse</span>(age <span class="sc">&lt;</span> <span class="dv">40</span>,</span>
<span id="annotated-cell-13-4"><a href="#annotated-cell-13-4" aria-hidden="true" tabindex="-1"></a>                                                            <span class="st">"30-39 years"</span>,</span>
<span id="annotated-cell-13-5"><a href="#annotated-cell-13-5" aria-hidden="true" tabindex="-1"></a>                                                            age_categorical),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-13-6" class="code-annotation-target"><a href="#annotated-cell-13-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">age_categorical =</span> <span class="fu">ifelse</span>(age<span class="sc">&gt;</span> <span class="dv">39</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">50</span>,</span>
<span id="annotated-cell-13-7"><a href="#annotated-cell-13-7" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">"40-49 years"</span>,</span>
<span id="annotated-cell-13-8"><a href="#annotated-cell-13-8" aria-hidden="true" tabindex="-1"></a>                                                           age_categorical),</span>
<span id="annotated-cell-13-9"><a href="#annotated-cell-13-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">age_categorical =</span> <span class="fu">ifelse</span>(age <span class="sc">&gt;</span> <span class="dv">49</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">60</span>,</span>
<span id="annotated-cell-13-10"><a href="#annotated-cell-13-10" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">"50-59 years"</span>,</span>
<span id="annotated-cell-13-11"><a href="#annotated-cell-13-11" aria-hidden="true" tabindex="-1"></a>                                                           age_categorical),</span>
<span id="annotated-cell-13-12"><a href="#annotated-cell-13-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">age_categorical =</span> <span class="fu">ifelse</span>(age <span class="sc">&gt;</span> <span class="dv">59</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">70</span>,</span>
<span id="annotated-cell-13-13"><a href="#annotated-cell-13-13" aria-hidden="true" tabindex="-1"></a>                                                             <span class="st">"60-69 years"</span>,</span>
<span id="annotated-cell-13-14"><a href="#annotated-cell-13-14" aria-hidden="true" tabindex="-1"></a>                                                             age_categorical))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="2" data-code-annotation="1">We first create a new variable containing only <code>NA</code>s.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="3,4,5" data-code-annotation="2">We replace values on the new variable for observations with <code>age</code> less than 40 and keep the existing values for the other observations</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="6,7,8,10,11,12,13,14" data-code-annotation="3">Then we sequentially replace the values using the appropriate logical conditions (and always keeping the existing values for the observations that don’t satisfy the condition).</span>
</dd>
</dl>
</div>
</div>
<p>We can get a quick sense of the variable, we created using <code>table()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(who_gov_norway_ministers<span class="sc">$</span>age_categorical)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
30-39 years 40-49 years 50-59 years 60-69 years 
        122         401         397          94 </code></pre>
</div>
</div>
<p>The above code, works just fine, but this approach is a little cluttered. <code>case_when()</code> allows you to simplify this type of code. Let’s rewrite the same code, using <code>case_when()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-15-1"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> <span class="fu">mutate</span>(who_gov_norway_ministers, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-2" class="code-annotation-target"><a href="#annotated-cell-15-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">age_categorical =</span> <span class="fu">case_when</span>(age <span class="sc">&lt;</span> <span class="dv">40</span> <span class="sc">~</span> <span class="st">"30-39 years"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-15-3" class="code-annotation-target"><a href="#annotated-cell-15-3" aria-hidden="true" tabindex="-1"></a>                                                               age <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"40-49 years"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-15-4" class="code-annotation-target"><a href="#annotated-cell-15-4" aria-hidden="true" tabindex="-1"></a>                                                               age <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">"50-59 years"</span>,</span>
<span id="annotated-cell-15-5"><a href="#annotated-cell-15-5" aria-hidden="true" tabindex="-1"></a>                                                               age <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"60-69 years"</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="2" data-code-annotation="1">We want a new variable called “age_categorical” to be created using <code>case_when()</code>. If <code>age</code> is less than 40 this variable should take the value “30-39 years”.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="3" data-code-annotation="2">If the above condition was not <code>TRUE</code>, then we move on to evaluate the next condition which is whether <code>age</code> is less than 50. If so, the variable should get the value “40-49 years”.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="4,5" data-code-annotation="3">We follow the same logic for the remaining two conditions. Note that because the conditions are evaluated sequentially, we don’t to specify e.g.&nbsp;<code>age &gt; 39 &amp; age &lt; 50</code>. <code>age &lt; 50</code> suffices as we have already taken care of the observations that are younger than 40.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-16"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-16-1" class="code-annotation-target"><a href="#annotated-cell-16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(who_gov_norway_ministers<span class="sc">$</span>age_categorical)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="1" data-code-annotation="1">If we compare the output of this <code>table()</code> with the one created above, we see that two code chunks produce the same variable. The <code>case_when()</code> code is just much simpler. Woot!</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
30-39 years 40-49 years 50-59 years 60-69 years 
        122         401         397          94 </code></pre>
</div>
</div>
<p>In the <code>case_when()</code> code above observations that don’t specify any of the conditions will get <code>NA</code>s on the variable that is created. Sometimes, we want to use <code>case_when()</code> to recode a variable for specific conditions and keep the original value for those observations that don’t match any of the conditions. Using the placeholder <code>TRUE</code> in the <code>case_when()</code> code, we can specify what happens with those observations that don’t satisfy any of the conditions. We could exploit this to simplify our code for correcting the coding of Einar Hole Moxnes and Kåre Gjønnes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-17-1"><a href="#annotated-cell-17-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> who_gov_norway_ministers <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-17-2"><a href="#annotated-cell-17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Moynes Einsi"</span> <span class="sc">~</span> <span class="st">"Einar Hole Moxnes"</span>, </span>
<span id="annotated-cell-17-3"><a href="#annotated-cell-17-3" aria-hidden="true" tabindex="-1"></a>                          name <span class="sc">==</span> <span class="st">"Kare Gennes"</span> <span class="sc">~</span> <span class="st">"Kare Gjonnes"</span>, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-17-4" class="code-annotation-target"><a href="#annotated-cell-17-4" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> name),</span>
<span id="annotated-cell-17-5"><a href="#annotated-cell-17-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">party  =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span> <span class="sc">~</span> <span class="st">"sp"</span>, </span>
<span id="annotated-cell-17-6"><a href="#annotated-cell-17-6" aria-hidden="true" tabindex="-1"></a>                          name <span class="sc">==</span> <span class="st">"Kare Gjonnes"</span> <span class="sc">~</span> <span class="st">"krf"</span>, </span>
<span id="annotated-cell-17-7"><a href="#annotated-cell-17-7" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> party ),</span>
<span id="annotated-cell-17-8"><a href="#annotated-cell-17-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">birthyear  =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span> <span class="sc">~</span> <span class="dv">1921</span>, </span>
<span id="annotated-cell-17-9"><a href="#annotated-cell-17-9" aria-hidden="true" tabindex="-1"></a>                          name <span class="sc">==</span> <span class="st">"Kare Gjonnes"</span> <span class="sc">~</span> <span class="dv">1942</span>, </span>
<span id="annotated-cell-17-10"><a href="#annotated-cell-17-10" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> birthyear ),</span>
<span id="annotated-cell-17-11"><a href="#annotated-cell-17-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">deadyear  =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span> <span class="sc">~</span> <span class="dv">2006</span>, </span>
<span id="annotated-cell-17-12"><a href="#annotated-cell-17-12" aria-hidden="true" tabindex="-1"></a>                          name <span class="sc">==</span> <span class="st">"Kare Gjonnes"</span> <span class="sc">~</span> <span class="dv">2021</span>, </span>
<span id="annotated-cell-17-13"><a href="#annotated-cell-17-13" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> birthyear ),</span>
<span id="annotated-cell-17-14"><a href="#annotated-cell-17-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender  =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span> <span class="sc">~</span> <span class="st">"Male"</span>, </span>
<span id="annotated-cell-17-15"><a href="#annotated-cell-17-15" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> gender ))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="4,7,10,13,15" data-code-annotation="1">Using <code>TRUE ~</code> we can specify what happens to those observations that don’t satisfy any of the conditions. Otherwise those observations would get <code>NA</code>s.</span>
</dd>
</dl>
</div>
</div>
</section>
</section>
<section id="using-pipes" class="level2">
<h2 class="anchored" data-anchor-id="using-pipes">Using pipes (<code>%&gt;%</code>)</h2>
<p>Pipes (<code>%&gt;%</code>) allow you to combine a sequence of multiple operations, such as multiple <code>dplyr</code> verbs that need to be executed sequentially to produce the out we want. Pipes make our code easier to read and understand.</p>
<p>In RStudio, you can get a <code>%&gt;%</code> by pressing <code>ctrl+shift+m</code>/<code>cmd+shift+m</code></p>
<p>The <code>%&gt;%</code> operator comes from the <code>magrittr</code>, but is automatically loaded with all <code>tidyverse packages</code> such as <code>dplyr</code> and using pipes is particularly useful in data wrangling as we typically will perform a long chain of operations to produce the dataset that we need for our analysis.</p>
<p>Using pipes, we can perform all the operations we did to produce <code>who_gov_norway_ministers</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-18"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-18-1" class="code-annotation-target"><a href="#annotated-cell-18-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> who_gov <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-18-2" class="code-annotation-target"><a href="#annotated-cell-18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_isocode <span class="sc">==</span> <span class="st">"NOR"</span>,</span>
<span id="annotated-cell-18-3"><a href="#annotated-cell-18-3" aria-hidden="true" tabindex="-1"></a>         classification <span class="sc">==</span> <span class="st">"Prime Minister"</span> <span class="sc">|</span></span>
<span id="annotated-cell-18-4"><a href="#annotated-cell-18-4" aria-hidden="true" tabindex="-1"></a>           classification <span class="sc">==</span> <span class="st">"Minister (Full Rank)"</span>) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-18-5" class="code-annotation-target"><a href="#annotated-cell-18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, id, position, name,</span>
<span id="annotated-cell-18-6"><a href="#annotated-cell-18-6" aria-hidden="true" tabindex="-1"></a>         gender,  birthyear, deadyear, party, classification) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-18-7" class="code-annotation-target"><a href="#annotated-cell-18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">minister_type =</span> classification) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-18-8" class="code-annotation-target"><a href="#annotated-cell-18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Moynes Einsi"</span> <span class="sc">~</span> <span class="st">"Einar Hole Moxnes"</span>,</span>
<span id="annotated-cell-18-9"><a href="#annotated-cell-18-9" aria-hidden="true" tabindex="-1"></a>                          name <span class="sc">==</span> <span class="st">"Kare Gennes"</span> <span class="sc">~</span> <span class="st">"Kare Gjonnes"</span>,</span>
<span id="annotated-cell-18-10"><a href="#annotated-cell-18-10" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> name),</span>
<span id="annotated-cell-18-11"><a href="#annotated-cell-18-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">party  =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span> <span class="sc">~</span> <span class="st">"sp"</span>, </span>
<span id="annotated-cell-18-12"><a href="#annotated-cell-18-12" aria-hidden="true" tabindex="-1"></a>                          name <span class="sc">==</span> <span class="st">"Kare Gjonnes"</span> <span class="sc">~</span> <span class="st">"krf"</span>,</span>
<span id="annotated-cell-18-13"><a href="#annotated-cell-18-13" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> party ),</span>
<span id="annotated-cell-18-14"><a href="#annotated-cell-18-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">birthyear  =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span> <span class="sc">~</span> <span class="dv">1921</span>,</span>
<span id="annotated-cell-18-15"><a href="#annotated-cell-18-15" aria-hidden="true" tabindex="-1"></a>                          name <span class="sc">==</span> <span class="st">"Kare Gjonnes"</span> <span class="sc">~</span> <span class="dv">1942</span>,</span>
<span id="annotated-cell-18-16"><a href="#annotated-cell-18-16" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> birthyear ),</span>
<span id="annotated-cell-18-17"><a href="#annotated-cell-18-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">deadyear  =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span> <span class="sc">~</span> <span class="dv">2006</span>,</span>
<span id="annotated-cell-18-18"><a href="#annotated-cell-18-18" aria-hidden="true" tabindex="-1"></a>                          name <span class="sc">==</span> <span class="st">"Kare Gjonnes"</span> <span class="sc">~</span> <span class="dv">2021</span>,</span>
<span id="annotated-cell-18-19"><a href="#annotated-cell-18-19" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> birthyear ),</span>
<span id="annotated-cell-18-20"><a href="#annotated-cell-18-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender  =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Einar Hole Moxnes"</span> <span class="sc">~</span> <span class="st">"Male"</span>,</span>
<span id="annotated-cell-18-21"><a href="#annotated-cell-18-21" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> gender),</span>
<span id="annotated-cell-18-22"><a href="#annotated-cell-18-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> year <span class="sc">-</span> birthyear,</span>
<span id="annotated-cell-18-23"><a href="#annotated-cell-18-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_categorical =</span> <span class="fu">case_when</span>(age <span class="sc">&lt;</span> <span class="dv">40</span> <span class="sc">~</span> <span class="st">"30-39 years"</span>,</span>
<span id="annotated-cell-18-24"><a href="#annotated-cell-18-24" aria-hidden="true" tabindex="-1"></a>                                     age <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"40-49 years"</span>,</span>
<span id="annotated-cell-18-25"><a href="#annotated-cell-18-25" aria-hidden="true" tabindex="-1"></a>                                     age <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">"50-59 years"</span>,</span>
<span id="annotated-cell-18-26"><a href="#annotated-cell-18-26" aria-hidden="true" tabindex="-1"></a>                                     age <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"60-69 years"</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="1" data-code-annotation="1">We start a sequence of operations with a <code>data.frame</code>, here <code>who_gov</code>. We may choose to assign the result of the sequence of operation that follows to an object. Here we assign the result to <code>who_gov_norway_ministers</code>. We end the line with a <code>%&gt;%</code> which tells R that more commands will follow to produce our desired result.</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="2,3,4" data-code-annotation="2">We then <code>filter()</code> the data. We don’t need to specify the dataset in <code>filter()</code> (or in any of the subsequent operations) because R will continue to use the data from the line above in the sequence of operations. We end the line with a <code>%&gt;%</code> to tell R that more functions are coming.</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="5,6" data-code-annotation="3">We then <code>select()</code>the columns we want and end the line with a <code>%&gt;%</code> to let R know that more is coming.</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="7" data-code-annotation="4">We then<code>rename()</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="8,9,10,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26" data-code-annotation="5">Finally, we use <code>mutate()</code> to calculate new variables and recode existing ones. Because the line doesn’t end in a <code>%&gt;%</code>, the sequence of operations ends here.</span>
</dd>
</dl>
</div>
</div>
<p>We think that pipes are great for making sequences of operations performed on the same input data more readable! And now that you have seen how they work, we will be using them a lot in the what follows!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>%&gt;%</code> vs.&nbsp;<code>|&gt;</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pipes were introduced to R with the <code>magrittr</code> package which is where the <code>%&gt;%</code> operator comes from. Pipes proved immensely popular and in version 4.1 of R (released in 2021), a pipe operator (<code>|&gt;</code>) was included in base R.</p>
<p>For the most part, the “native” pipe operator, <code>|&gt;</code>, works like the <code>%&gt;%</code> operator, but there are some important exceptions, which you can read more about <a href="https://www.tidyverse.org/blog/2023/04/base-vs-magrittr-pipe/">here</a>.</p>
<p>We will be sticking to the <code>%&gt;%</code> operator and this course, but the <code>|&gt;</code> operator is still useful to be aware of as you are likely to encounter it in code written by others.</p>
</div>
</div>
</section>
<section id="grouping-data-using-group_by" class="level2">
<h2 class="anchored" data-anchor-id="grouping-data-using-group_by">Grouping data using <code>group_by()</code></h2>
<p>We often have datasets in which the observations are grouped in some way.</p>
<p>In <code>who_gov_norway_ministers</code> there are multiple observations of the same people (identified by <code>who_gov_norway_ministers$name</code>), multiple observations from the same year (identified by <code>who_gov_norway_ministers$year</code>), multiple observations of the same positions (identified by <code>who_gov_norway_ministers$position</code>), and so on. Perhaps, we want to create a new variable capturing which cabinet each observation was part of, thus creating a new potential grouping variable.</p>
<p>Often we want to calculations within each group. For instance, we may want to calculate the age of each person when they first achieved a position in a Norwegian cabinet.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> To do that we first need to <code>group_by(name)</code>. After we have grouped the data, we can do operations on the data within each “group”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> who_gov_norway_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_when_first_entering_a_cabinet =</span> <span class="fu">min</span>(age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we print out the first few rows on selected variables, we will see that <code>who_gov_norway_ministers$age_when_first_entering_a_cabinet</code> varies by <code>who_gov_norway_ministers$name</code>, but is constant within each <code>who_gov_norway_ministers$name</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, year, age, age_when_first_entering_a_cabinet) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
# Groups:   name [15]
   name                         year   age age_when_first_entering_a_cabinet
   &lt;chr&gt;                       &lt;dbl&gt; &lt;dbl&gt;                             &lt;dbl&gt;
 1 Per Borten                   1966    53                                53
 2 Bjarne Lyngstad              1966    65                                65
 3 Kjell Bondevik               1966    65                                65
 4 Kaare Willoch                1966    38                                38
 5 Haakon Kyllingmark           1966    51                                51
 6 Otto Grieg Tidemand          1966    45                                45
 7 Ole Myrvoll                  1966    55                                55
 8 Oddmund Myklebust            1966    51                                51
 9 John Lyng                    1966    61                                61
10 Sverre Walter Rostoft        1966    54                                54
11 Ragnhild Schweigaard Selmer  1966    43                                43
12 Helge Seip                   1966    47                                47
13 Egil Aarvik                  1966    54                                54
14 Dagfinn Varvik               1966    42                                42
15 Else Skjerven                1966    47                                47
16 Per Borten                   1967    54                                53
17 Bjarne Lyngstad              1967    66                                65
18 Kjell Bondevik               1967    66                                65
19 Kaare Willoch                1967    39                                38
20 Haakon Kyllingmark           1967    52                                51</code></pre>
</div>
</div>
<p>When we are done with applying functions within a particular group, it is useful to <code>ungroup()</code> the data so that R will not apply subsequent functions within the group. Running the following code will remove the grouping of the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="ot">&lt;-</span> who_gov_norway_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarize" class="level2">
<h2 class="anchored" data-anchor-id="summarize"><code>summarize()</code></h2>
<p>Suppose we are interested in the share of female ministers each year. We then need first to <code>group_by(year)</code>. we could use <code>mutate()</code> to add new variable with the share of female ministers each year to the <code>who_gov_norway_ministers</code> data, but this might not be those most convenient format, if we want to report the annual shares in a table or figure. Instead we want to <code>summarize()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-22"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-22" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-22-1" class="code-annotation-target"><a href="#annotated-cell-22-1" aria-hidden="true" tabindex="-1"></a>share_female_ministers <span class="ot">&lt;-</span> who_gov_norway_ministers <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-22" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-22-2" class="code-annotation-target"><a href="#annotated-cell-22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-22" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-22-3" class="code-annotation-target"><a href="#annotated-cell-22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">share_female_ministers =</span> <span class="fu">mean</span>(gender <span class="sc">==</span> <span class="st">"Female"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="annotated-cell-22-4"><a href="#annotated-cell-22-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="annotated-cell-22-5"><a href="#annotated-cell-22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-22-6"><a href="#annotated-cell-22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(who_gov<span class="sc">$</span>year) </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-22" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-lines="1" data-code-annotation="1">We want to use <code>who_gov_norway_ministers</code> as our input <code>data.frame</code>, but we will assign the result to a new object <code>share_female_ministers</code></span>
</dd>
<dt data-target-cell="annotated-cell-22" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-lines="2" data-code-annotation="2">We <code>group_by(year)</code> to the operations that follow within each year.</span>
</dd>
<dt data-target-cell="annotated-cell-22" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-lines="3" data-code-annotation="3"><code>summarize()</code> will calculate the share of female ministers each year and aggregate the data to have one row per year. The only columns will be the grouping variable (<code>year</code>) and the variable(s) we create inside the summary call.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 1973 1974 1975 1976 1977 1978 
  14   14   14 2767 2743 2809 2879 2961 3086 3217 3290 3314 3495 3534 3640 3687 
1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990 1991 1992 1993 1994 
3782 3813 3955 3975 4153 4187 4100 4167 4215 4203 4216 4074 4027 4331 4671 4852 
1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 
5040 5236 5242 5191 5239 5229 5375 5348 5233 5177 5115 5175 5255 5211 5289 5332 
2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 
5272 5353 5366 5329 5271 5247 5242 5280 5243 5249 5233 </code></pre>
</div>
</div>
<p>The resulting <code>data.frame</code> looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(share_female_ministers, <span class="at">n =</span> <span class="fu">nrow</span>(share_female_ministers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 2
    year share_female_ministers
   &lt;dbl&gt;                  &lt;dbl&gt;
 1  1966                 0.133 
 2  1967                 0.133 
 3  1968                 0.133 
 4  1969                 0.133 
 5  1970                 0.133 
 6  1971                 0.0667
 7  1972                 0.0667
 8  1973                 0.2   
 9  1974                 0.2   
10  1975                 0.188 
11  1976                 0.25  
12  1977                 0.25  
13  1978                 0.235 
14  1979                 0.25  
15  1980                 0.125 
16  1981                 0.25  
17  1982                 0.235 
18  1983                 0.222 
19  1984                 0.222 
20  1985                 0.222 
21  1986                 0.444 
22  1987                 0.444 
23  1988                 0.444 
24  1989                 0.444 
25  1990                 0.421 
26  1991                 0.474 
27  1992                 0.474 
28  1993                 0.421 
29  1994                 0.421 
30  1995                 0.421 
31  1996                 0.421 
32  1997                 0.45  
33  1998                 0.5   
34  1999                 0.4   
35  2000                 0.421 
36  2001                 0.421 
37  2002                 0.421 
38  2003                 0.421 
39  2004                 0.421 
40  2005                 0.421 
41  2006                 0.474 
42  2007                 0.474 
43  2008                 0.429 
44  2009                 0.45  
45  2010                 0.476 
46  2011                 0.476 
47  2012                 0.5   
48  2013                 0.524 
49  2014                 0.5   
50  2015                 0.5   
51  2016                 0.444 
52  2017                 0.45  
53  2018                 0.45  
54  2019                 0.45  
55  2020                 0.4   
56  2021                 0.4   </code></pre>
</div>
</div>
<p>We might want more than one summary statistics per year. For instance, we might want to add the count of female ministers, and the count of ministers in total and the share of ministers from each of the different parties:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-24"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-24-1" class="code-annotation-target"><a href="#annotated-cell-24-1" aria-hidden="true" tabindex="-1"></a>shares_and_counts <span class="ot">&lt;-</span> who_gov_norway_ministers <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-24-2" class="code-annotation-target"><a href="#annotated-cell-24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-24-3" class="code-annotation-target"><a href="#annotated-cell-24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">share_female_ministers =</span> <span class="fu">mean</span>(gender <span class="sc">==</span> <span class="st">"Female"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="annotated-cell-24-4"><a href="#annotated-cell-24-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">count_female_ministers =</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="st">"Female"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-24-5" class="code-annotation-target"><a href="#annotated-cell-24-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">count_ministers =</span> <span class="fu">n</span>(),</span>
<span id="annotated-cell-24-6"><a href="#annotated-cell-24-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">share_dna =</span> <span class="fu">mean</span>(party <span class="sc">==</span> <span class="st">"dna"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="annotated-cell-24-7"><a href="#annotated-cell-24-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">share_hoyre=</span> <span class="fu">mean</span>(party <span class="sc">==</span> <span class="st">"h"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="annotated-cell-24-8"><a href="#annotated-cell-24-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">share_sp=</span> <span class="fu">mean</span>(party <span class="sc">==</span> <span class="st">"sp"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="annotated-cell-24-9"><a href="#annotated-cell-24-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">share_venstre =</span> <span class="fu">mean</span>(party <span class="sc">==</span> <span class="st">"v"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="annotated-cell-24-10"><a href="#annotated-cell-24-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">share_frp =</span> <span class="fu">mean</span>(party <span class="sc">==</span> <span class="st">"fr"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="annotated-cell-24-11"><a href="#annotated-cell-24-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">share_sv =</span> <span class="fu">mean</span>(party <span class="sc">==</span> <span class="st">"sv"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="annotated-cell-24-12"><a href="#annotated-cell-24-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">share_krf =</span> <span class="fu">mean</span>(party <span class="sc">==</span> <span class="st">"krf"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span>
<span id="annotated-cell-24-13"><a href="#annotated-cell-24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-24-14"><a href="#annotated-cell-24-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(shares_and_counts)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-24" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="1" data-code-annotation="1">We use <code>who_gov_norway_ministers</code> as the input data, but we don’t assign the result to a new object. The result will then instead be printed in the console.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="2" data-code-annotation="2">We group the data by year.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="3,4" data-code-annotation="3">We now calculate multiple summary statistics for each year.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="5" data-code-annotation="4">The <code>n()</code> function can be used to find the total number of observations within a group.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 11
    year share_female_ministers count_female_ministers count_ministers share_dna
   &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;int&gt;           &lt;int&gt;     &lt;dbl&gt;
 1  1966                 0.133                       2              15         0
 2  1967                 0.133                       2              15         0
 3  1968                 0.133                       2              15         0
 4  1969                 0.133                       2              15         0
 5  1970                 0.133                       2              15         0
 6  1971                 0.0667                      1              15         1
 7  1972                 0.0667                      1              15         1
 8  1973                 0.2                         3              15         0
 9  1974                 0.2                         3              15         1
10  1975                 0.188                       3              16         1
# ℹ 46 more rows
# ℹ 6 more variables: share_hoyre &lt;dbl&gt;, share_sp &lt;dbl&gt;, share_venstre &lt;dbl&gt;,
#   share_frp &lt;dbl&gt;, share_sv &lt;dbl&gt;, share_krf &lt;dbl&gt;</code></pre>
</div>
</div>
<p>You can also use <code>summarize()</code> with a group. If so, <code>summarize()</code> will calculate the summary statistics for the full dataset. For instance we can get the share of female ministers in the <code>who_gov_norway_ministers</code> as a whole like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">share_female_ministers =</span> <span class="fu">mean</span>(gender <span class="sc">==</span> <span class="st">"Female"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  share_female_ministers
                   &lt;dbl&gt;
1                  0.365</code></pre>
</div>
</div>
<p>The above code produces a single number because the share is calculated across all the observations in the dataset.</p>
</section>
<section id="mutate-or-summarize-across-multiple-columns" class="level2">
<h2 class="anchored" data-anchor-id="mutate-or-summarize-across-multiple-columns"><code>mutate()</code> or <code>summarize()</code> <code>across()</code> multiple columns</h2>
<p>We often need to the the same <code>mutate()</code> or <code>summarize()</code> operations <code>across()</code> multiple columns. We <code>across()</code> and the helper functions for <code>select()</code> to do the same operation for a defined set of columns. Suppose for instance that we wanted to recode all the variables with “shares” in the <code>shares_and_counts</code> <code>data.frame</code> we created above to percentages, but we wanted to keep the “counts” unchanged. Combining <code>across()</code> and an appropriate <code>select()</code> helper functions makes this straightforward:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-26"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-26-1"><a href="#annotated-cell-26-1" aria-hidden="true" tabindex="-1"></a>percentages_and_counts <span class="ot">&lt;-</span> shares_and_counts <span class="sc">%&gt;%</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-26-2" class="code-annotation-target"><a href="#annotated-cell-26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">contains</span>(<span class="st">"share"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-26-3" class="code-annotation-target"><a href="#annotated-cell-26-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="cf">function</span> (x) {</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-26-4" class="code-annotation-target"><a href="#annotated-cell-26-4" aria-hidden="true" tabindex="-1"></a>                  x <span class="sc">*</span><span class="dv">100</span></span>
<span id="annotated-cell-26-5"><a href="#annotated-cell-26-5" aria-hidden="true" tabindex="-1"></a>                }))</span>
<span id="annotated-cell-26-6"><a href="#annotated-cell-26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-7"><a href="#annotated-cell-26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(percentages_and_counts)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-26" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="2" data-code-annotation="1">We use <code>across()</code> inside <code>mutate()</code> (we may also use it inside <code>summarize()</code>). Using the <code>.cols</code> argument and the <code>select()</code> helper function <code>contains()</code> we specify that we want to do something with all the columns with “share” in the column name.</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="3" data-code-annotation="2">For the <code>.fns</code> argument we specify the function that should be applied across the selected columns. We may give the name of an existing function or we may define a function using <code>function()</code>. <a href="https://pages.github.uio.no/oyvinsti/STV4030A/basics_refresh/Functions.html">Our knowledge of how to define our own function now comes in handy!</a></span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="4" data-code-annotation="3">Our function is in this case very simple. It takes the value <code>x</code> and multiplies it with 100. This will turn our shares into percentages.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 11
    year share_female_ministers count_female_ministers count_ministers share_dna
   &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;int&gt;           &lt;int&gt;     &lt;dbl&gt;
 1  1966                  13.3                       2              15         0
 2  1967                  13.3                       2              15         0
 3  1968                  13.3                       2              15         0
 4  1969                  13.3                       2              15         0
 5  1970                  13.3                       2              15         0
 6  1971                   6.67                      1              15       100
 7  1972                   6.67                      1              15       100
 8  1973                  20                         3              15         0
 9  1974                  20                         3              15       100
10  1975                  18.8                       3              16       100
# ℹ 46 more rows
# ℹ 6 more variables: share_hoyre &lt;dbl&gt;, share_sp &lt;dbl&gt;, share_venstre &lt;dbl&gt;,
#   share_frp &lt;dbl&gt;, share_sv &lt;dbl&gt;, share_krf &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="arrange" class="level2">
<h2 class="anchored" data-anchor-id="arrange"><code>arrange()</code></h2>
<p>We can change the order of the rows in the dataset by using <code>arrange()</code>. For instance, let’s say we wanted the rows in our <code>share_female_ministers</code> dataset to be sorted not by year, but by the share of female ministers. We would then then:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>share_female_ministers <span class="ot">&lt;-</span> share_female_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(share_female_ministers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we print out <code>share_female_ministers</code>, the <code>data.frame</code> will now be sorted by the values on <code>share_female_ministers$share_female_ministers</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(share_female_ministers, <span class="at">n =</span> <span class="dv">33</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 2
    year share_female_ministers
   &lt;dbl&gt;                  &lt;dbl&gt;
 1  1971                 0.0667
 2  1972                 0.0667
 3  1980                 0.125 
 4  1966                 0.133 
 5  1967                 0.133 
 6  1968                 0.133 
 7  1969                 0.133 
 8  1970                 0.133 
 9  1975                 0.188 
10  1973                 0.2   
11  1974                 0.2   
12  1983                 0.222 
13  1984                 0.222 
14  1985                 0.222 
15  1978                 0.235 
16  1982                 0.235 
17  1976                 0.25  
18  1977                 0.25  
19  1979                 0.25  
20  1981                 0.25  
21  1999                 0.4   
22  2020                 0.4   
23  2021                 0.4   
24  1990                 0.421 
25  1993                 0.421 
26  1994                 0.421 
27  1995                 0.421 
28  1996                 0.421 
29  2000                 0.421 
30  2001                 0.421 
31  2002                 0.421 
32  2003                 0.421 
33  2004                 0.421 
# ℹ 23 more rows</code></pre>
</div>
</div>
<p>By default, the data will be arranged in ascending order (with the lowest values first). To instead <code>arrange()</code> the data in descending order (with the highest values first), we can use <code>desc()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>share_female_ministers <span class="ot">&lt;-</span> share_female_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(share_female_ministers))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(share_female_ministers, <span class="at">n =</span> <span class="dv">33</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 2
    year share_female_ministers
   &lt;dbl&gt;                  &lt;dbl&gt;
 1  2013                  0.524
 2  1998                  0.5  
 3  2012                  0.5  
 4  2014                  0.5  
 5  2015                  0.5  
 6  2010                  0.476
 7  2011                  0.476
 8  1991                  0.474
 9  1992                  0.474
10  2006                  0.474
11  2007                  0.474
12  1997                  0.45 
13  2009                  0.45 
14  2017                  0.45 
15  2018                  0.45 
16  2019                  0.45 
17  1986                  0.444
18  1987                  0.444
19  1988                  0.444
20  1989                  0.444
21  2016                  0.444
22  2008                  0.429
23  1990                  0.421
24  1993                  0.421
25  1994                  0.421
26  1995                  0.421
27  1996                  0.421
28  2000                  0.421
29  2001                  0.421
30  2002                  0.421
31  2003                  0.421
32  2004                  0.421
33  2005                  0.421
# ℹ 23 more rows</code></pre>
</div>
</div>
</section>
<section id="distinct" class="level2">
<h2 class="anchored" data-anchor-id="distinct"><code>distinct()</code></h2>
<p><code>distinct()</code> is useful for making sure that observations in the data are not duplicated. Let’s say we want to produce a list of all the prime ministers in Norway. We could start by using <code>filter()</code> to subset the data to prime ministers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(minister_type <span class="sc">==</span> <span class="st">"Prime Minister"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 12
    year    id position      name  gender birthyear deadyear party minister_type
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;        
 1  1966     2 Prime Minist… Per … Male        1913     1913 sp    Prime Minist…
 2  1967    18 Prime Minist… Per … Male        1913     1913 sp    Prime Minist…
 3  1968    34 Prime Minist… Per … Male        1913     1913 sp    Prime Minist…
 4  1969    50 Prime Minist… Per … Male        1913     1913 sp    Prime Minist…
 5  1970    66 Prime Minist… Per … Male        1913     1913 sp    Prime Minist…
 6  1971    82 Prime Minist… Tryg… Male        1910     1910 dna   Prime Minist…
 7  1972    98 Prime Minist… Tryg… Male        1910     1910 dna   Prime Minist…
 8  1973   114 Prime Minist… Lars… Male        1916     1916 krf   Prime Minist…
 9  1974   130 Prime Minist… Tryg… Male        1910     1910 dna   Prime Minist…
10  1975   146 Prime Minist… Tryg… Male        1910     1910 dna   Prime Minist…
# ℹ 46 more rows
# ℹ 3 more variables: age &lt;dbl&gt;, age_categorical &lt;chr&gt;,
#   age_when_first_entering_a_cabinet &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The above code subsets to the prime ministers, but we now get repeated observations of the prime ministers (one row for each year they were in office). We can use <code>distinct()</code> to only get one observation per <code>who_gov_norway_ministers$name</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(minister_type <span class="sc">==</span> <span class="st">"Prime Minister"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 1
   name                 
   &lt;chr&gt;                
 1 Per Borten           
 2 Trygve Bratteli      
 3 Lars Korvald         
 4 Odvar Nordli         
 5 Gro Harlem Brundtland
 6 Kaare Willoch        
 7 Jan P. Syse          
 8 Thorbjorn Jagland    
 9 Kjell Magne Bondevik 
10 Jens Stoltenberg     
11 Erna Solberg         </code></pre>
</div>
</div>
<p>We now only have one observation per person, but we lost all of the other variables. We can change this behavior in two different ways, first, we can add the other variables we want (and which do not vary within each prime minister) inside the <code>distinct()</code> call:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(minister_type <span class="sc">==</span> <span class="st">"Prime Minister"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(name, birthyear, deadyear, party)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
   name                  birthyear deadyear party
   &lt;chr&gt;                     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;
 1 Per Borten                 1913     1913 sp   
 2 Trygve Bratteli            1910     1910 dna  
 3 Lars Korvald               1916     1916 krf  
 4 Odvar Nordli               1927     1927 dna  
 5 Gro Harlem Brundtland      1939     1939 dna  
 6 Kaare Willoch              1928     1928 h    
 7 Jan P. Syse                1930     1930 h    
 8 Thorbjorn Jagland          1950     1950 dna  
 9 Kjell Magne Bondevik       1947     1947 krf  
10 Jens Stoltenberg           1959     1959 dna  
11 Erna Solberg               1961     1961 h    </code></pre>
</div>
</div>
<p>Alternatively, we could say that we want to <code>.keep_all</code> the variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>who_gov_norway_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(minister_type <span class="sc">==</span> <span class="st">"Prime Minister"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(name, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 12
    year    id position      name  gender birthyear deadyear party minister_type
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;        
 1  1966     2 Prime Minist… Per … Male        1913     1913 sp    Prime Minist…
 2  1971    82 Prime Minist… Tryg… Male        1910     1910 dna   Prime Minist…
 3  1973   114 Prime Minist… Lars… Male        1916     1916 krf   Prime Minist…
 4  1976   163 Prime Minist… Odva… Male        1927     1927 dna   Prime Minist…
 5  1981   249 Prime Minist… Gro … Female      1939     1939 dna   Prime Minist…
 6  1982   266 Prime Minist… Kaar… Male        1928     1928 h     Prime Minist…
 7  1990   423 Prime Minist… Jan … Male        1930     1930 h     Prime Minist…
 8  1997   575 Prime Minist… Thor… Male        1950     1950 dna   Prime Minist…
 9  1998   599 Prime Minist… Kjel… Male        1947     1947 krf   Prime Minist…
10  2000   647 Prime Minist… Jens… Male        1959     1959 dna   Prime Minist…
11  2014   979 Prime Min.    Erna… Female      1961     1961 h     Prime Minist…
# ℹ 3 more variables: age &lt;dbl&gt;, age_categorical &lt;chr&gt;,
#   age_when_first_entering_a_cabinet &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="combining-datasets-with-dplyr" class="level1">
<h1>Combining datasets with <code>dplyr</code></h1>
<p>So far, we have been using <code>dplyr</code> verbs to manipulate individual dataset. Very often we will also need to combine multiple datasets. Fortunately, <code>dplyr</code> has a set of functions for <em>joining</em> and <em>binding</em> datasets.</p>
<section id="joining-also-called-merging-data" class="level2">
<h2 class="anchored" data-anchor-id="joining-also-called-merging-data">Joining (also called “merging”) data</h2>
<p>We can use mutating joins, to combine datasets that share <em>keys</em> or <em>ID-variables</em>, meaning one or more variables that uniquely identify the observations at the level on which they will be joined.</p>
<p>In some cases, you will only need a single variable to have your <em>key</em>. For instance, if you are joining two datasets that have one row per country, you my join the two datasets if you have one or more variables uniquely identifying each country in both dataset. If you are joining two datasets both containing one row per country per year, you may use two variables to uniquely identify each country and each year in both datasets (or alternatively, you may have a “country-year” variable in both datasets).</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The key needs to be consistent across the datasets!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the variables need to be identical across the datasets you want to join. If you have the value “Ivory Coast” on the country variable in one of the datasets and “Côte d’Ivoire” in the other dataset, R will not know that these observations are of the same country. For this reason, it is useful to use one of the many standardized ID variables for your countries, such as the <a href="http://ksgleditsch.com/data/iisystem.dat"><span class="citation" data-cites="gleditsch1999revised">Gleditsch and Ward (<span>1999</span>)</span> country codes</a> or perhaps one of the country code standards from the <a href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes">International Organization for Standardization</a>.</p>
<p>Of course, this advice also applies to other types of keys. If we want to match two datasets where the unit of observations are individuals (such as government ministers, members of parliament, or judges) we would need a variable that uniquely identifies each individual in both datasets.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Use the <code>countrycode</code> package to convert country names to country codes and translate between different country codes
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="citation" data-cites="arel2018countrycode">Arel-Bundock, Enevoldsen, and Yetman (<a href="#ref-arel2018countrycode" role="doc-biblioref">2018</a>)</span> provide an excellent resource for students and scholars working with country data. The <code>countrycode()</code> function from their <a href="https://github.com/vincentarelbundock/countrycode"><code>countrycode</code> package</a> converts country names into various types of country codes and translates between different types of country codes.</p>
<p>To illustrate, let’s generate country codes that correspond to the country codes used by the <a href="https://v-dem.net/documents/25/countryunit_v13.pdf">Varieties of Democracy</a> project for all observations in the <code>who_gov</code> dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(countrycode)</span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a>who_gov <span class="ot">&lt;-</span> who_gov <span class="sc">%&gt;%</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-3" class="code-annotation-target"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vdem_countrycode =</span> <span class="fu">countrycode</span>(<span class="at">sourcevar =</span> country_name,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-4" class="code-annotation-target"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">origin =</span> <span class="st">"country.name"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-1-5" class="code-annotation-target"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">destination =</span> <span class="st">"vdem"</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="3" data-code-annotation="1">We need to specify <code>sourcevar</code> the variable used to generate the country codes. Often this will be the country names, but it may also be one of the different types of country codes if we need to translate between different standards.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="4" data-code-annotation="2">We need to specify how the <code>source.var</code> is coded. We set <code>origin</code> to “country.name” if we are generating the codes from country names. When translating between different country codes, we would set <code>origin</code> to whatever standard we are translating from.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="5" data-code-annotation="3">We supply the label for the type of country code we would like to generate to <code>destination</code>. You can get a list of the different standards and their labels by running <code>?countrycode::codelist</code> in your console.</span>
</dd>
</dl>
</div>
</div>
<p>Notice that the above code produces a warning message about country names that could not be unambiguously matched to a Varieties of Democracy country code. These observations will get <code>NA</code>s on the new <code>who_gov$vdem_countrycode</code>. To avoid losing them from your analysis, it would be useful to either set their Varieties of Democracy country code manually or to recode the <code>whogov$country_name</code> variable so that also these country names can be matched.</p>
</div>
</div>
<p>Let’s consider an example. Say, we want investigate the relationship between female representation in Norwegian cabinets and female representation in the Norwegian parliament. We already used WhoGov to investigate female representation in Norwegian cabinets.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Let’s also load some data on female representation in Norwegian parliament.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/stortinget_female_share_by_period.RData"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stortinget_female_share_by_period, <span class="at">n =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 2
   period_id share_female_mps
   &lt;chr&gt;                &lt;dbl&gt;
 1 1945-49             0.0467
 2 1950-53             0.0467
 3 1954-57             0.0464
 4 1958-61             0.0667
 5 1961-65             0.0867
 6 1965-69             0.08  
 7 1969-73             0.0933
 8 1973-77             0.153 
 9 1977-81             0.239 
10 1981-85             0.258 
11 1985-89             0.344 
12 1989-93             0.358 
13 1993-97             0.394 
14 1997-2001           0.364 
15 2001-2005           0.364 
16 2005-2009           0.379 
17 2009-2013           0.396 
18 2013-2017           0.396 
19 2017-2021           0.408 
20 2021-2025           0.450 </code></pre>
</div>
</div>
<p>The dataset <code>stortinget_female_share_by_period</code> contains the share of members of parliament that were female for each legislative period from the “1945-49” period to the “2021-2025” period.</p>
<p>If we are to join the <code>stortinget_female_share_by_period</code> with data on female representation in Norwegian cabinets from WhoGov, we need a <em>key</em> that uniquely identifies each observation in both datasets. In this case, we will need to make some choices as <code>stortinget_female_share_by_period</code> is measured at the level of the legislative period, while <code>who_gov</code> contains annual data on the composition of the cabinet.</p>
<p>One solution would be to create a legislative period variable in our <code>share_female_ministers</code> dataset. We already know how to do that using <code>mutate()</code> and <code>case_when()</code>.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>share_female_ministers <span class="ot">&lt;-</span> share_female_ministers <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period_id =</span> <span class="fu">case_when</span>(year <span class="sc">&lt;</span> <span class="dv">1974</span> <span class="sc">~</span> <span class="st">"1969-73"</span>, </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">1978</span> <span class="sc">~</span> <span class="st">"1973-77"</span>, </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">1982</span> <span class="sc">~</span> <span class="st">"1977-81"</span>, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">1986</span> <span class="sc">~</span> <span class="st">"1981-85"</span>, </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">1990</span> <span class="sc">~</span> <span class="st">"1985-89"</span>, </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">1994</span> <span class="sc">~</span> <span class="st">"1989-93"</span>, </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">1998</span> <span class="sc">~</span> <span class="st">"1993-97"</span>, </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">2002</span> <span class="sc">~</span> <span class="st">"1997-2001"</span>, </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">2006</span> <span class="sc">~</span> <span class="st">"2001-2005"</span>, </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">2010</span> <span class="sc">~</span> <span class="st">"2005-2009"</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">2014</span> <span class="sc">~</span> <span class="st">"2009-2013"</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">~</span> <span class="st">"2013-2017"</span>, </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">~</span> <span class="st">"2017-2021"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have a variable <code>period_id</code> in both <code>share_female_ministers</code> and <code>stortinget_female_share_by_period</code>. This variable uniquely identifies each observation in <code>stortinget_female_share_by_period</code>, but not in <code>stortinget_female_share_by_period</code>. We can use this <em>key</em> to join data at the level of the legislative period.</p>
<section id="left_join" class="level3">
<h3 class="anchored" data-anchor-id="left_join"><code>left_join()</code></h3>
<p>There are different types of <em>joins</em>, but <code>left_join()</code> is likely the one you will use the most. <code>left_join()</code> takes two dataset and join observations from the second dataset to the first dataset (i.e to the dataset on the left in our <code>left_join()</code> code.) by the <em>key</em> they have in common. Let’s join <code>stortinget_female_share_by_period</code> to <code>share_female_ministers</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-36"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-36-1" class="code-annotation-target"><a href="#annotated-cell-36-1" aria-hidden="true" tabindex="-1"></a>share_female_ministers_and_mps <span class="ot">&lt;-</span> <span class="fu">left_join</span>(share_female_ministers, stortinget_female_share_by_period,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-36-2" class="code-annotation-target"><a href="#annotated-cell-36-2" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">by =</span> <span class="st">"period_id"</span> )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-36" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="1" data-code-annotation="1">We use <code>left_join()</code> and specify the two datasets. Variables from the second dataset will be added to corresponding observations in the first dataset.</span>
</dd>
<dt data-target-cell="annotated-cell-36" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="2" data-code-annotation="2">The variable to join by.</span>
</dd>
</dl>
</div>
</div>
<p>This is the resulting <code>data.frame</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(share_female_ministers_and_mps, <span class="at">n =</span> <span class="fu">nrow</span>(share_female_ministers_and_mps))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 4
    year share_female_ministers period_id share_female_mps
   &lt;dbl&gt;                  &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;
 1  2013                 0.524  2009-2013           0.396 
 2  1998                 0.5    1997-2001           0.364 
 3  2012                 0.5    2009-2013           0.396 
 4  2014                 0.5    2013-2017           0.396 
 5  2015                 0.5    2013-2017           0.396 
 6  2010                 0.476  2009-2013           0.396 
 7  2011                 0.476  2009-2013           0.396 
 8  1991                 0.474  1989-93             0.358 
 9  1992                 0.474  1989-93             0.358 
10  2006                 0.474  2005-2009           0.379 
11  2007                 0.474  2005-2009           0.379 
12  1997                 0.45   1993-97             0.394 
13  2009                 0.45   2005-2009           0.379 
14  2017                 0.45   2013-2017           0.396 
15  2018                 0.45   2017-2021           0.408 
16  2019                 0.45   2017-2021           0.408 
17  1986                 0.444  1985-89             0.344 
18  1987                 0.444  1985-89             0.344 
19  1988                 0.444  1985-89             0.344 
20  1989                 0.444  1985-89             0.344 
21  2016                 0.444  2013-2017           0.396 
22  2008                 0.429  2005-2009           0.379 
23  1990                 0.421  1989-93             0.358 
24  1993                 0.421  1989-93             0.358 
25  1994                 0.421  1993-97             0.394 
26  1995                 0.421  1993-97             0.394 
27  1996                 0.421  1993-97             0.394 
28  2000                 0.421  1997-2001           0.364 
29  2001                 0.421  1997-2001           0.364 
30  2002                 0.421  2001-2005           0.364 
31  2003                 0.421  2001-2005           0.364 
32  2004                 0.421  2001-2005           0.364 
33  2005                 0.421  2001-2005           0.364 
34  1999                 0.4    1997-2001           0.364 
35  2020                 0.4    2017-2021           0.408 
36  2021                 0.4    2017-2021           0.408 
37  1976                 0.25   1973-77             0.153 
38  1977                 0.25   1973-77             0.153 
39  1979                 0.25   1977-81             0.239 
40  1981                 0.25   1977-81             0.239 
41  1978                 0.235  1977-81             0.239 
42  1982                 0.235  1981-85             0.258 
43  1983                 0.222  1981-85             0.258 
44  1984                 0.222  1981-85             0.258 
45  1985                 0.222  1981-85             0.258 
46  1973                 0.2    1969-73             0.0933
47  1974                 0.2    1973-77             0.153 
48  1975                 0.188  1973-77             0.153 
49  1966                 0.133  1969-73             0.0933
50  1967                 0.133  1969-73             0.0933
51  1968                 0.133  1969-73             0.0933
52  1969                 0.133  1969-73             0.0933
53  1970                 0.133  1969-73             0.0933
54  1980                 0.125  1977-81             0.239 
55  1971                 0.0667 1969-73             0.0933
56  1972                 0.0667 1969-73             0.0933</code></pre>
</div>
</div>
<p>Notice that the new <code>data.frame</code> called <code>share_female_ministers_and_mps</code> will have the same number of rows as <code>share_female_ministers</code>. It is good idea to check that this is indeed the case. We can verify using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(share_female_ministers) <span class="sc">==</span> <span class="fu">nrow</span>(share_female_ministers_and_mps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>If the above statement had evaluated to <code>FALSE</code>, it would have indicated a problem with our <em>key</em> resulting in the duplication of some rows. We would have wanted to investigate and correct our code before proceeding!</p>
<p>Let’s say we instead wanted to <code>left_join</code> <code>share_female_ministers</code> to <code>stortinget_female_share_by_period</code> using the first year of the legislative period as they <em>key</em>. We can add a year variable to our <code>stortinget_female_share_by_period</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-39"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-39-1"><a href="#annotated-cell-39-1" aria-hidden="true" tabindex="-1"></a>stortinget_female_share_by_period <span class="ot">&lt;-</span> stortinget_female_share_by_period <span class="sc">%&gt;%</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-39-2" class="code-annotation-target"><a href="#annotated-cell-39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substr</span>(period_id, <span class="dv">1</span>,<span class="dv">4</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-39-3" class="code-annotation-target"><a href="#annotated-cell-39-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">as.integer</span>(year),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-39-4" class="code-annotation-target"><a href="#annotated-cell-39-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> year <span class="sc">+</span><span class="dv">1</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-39" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="2" data-code-annotation="1"><code>substr(period_id, 1,4)</code> extracts the first 4 characters from each element of <code>period_id</code>, so for “1969-73” it extracts “1969”, for “2005-2009” it extracts “2005”, and so on.</span>
</dd>
<dt data-target-cell="annotated-cell-39" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="3" data-code-annotation="2">The extracted <code>year</code>s will be character strings, so we need to turn them into integers, which we can do using <code>as.integer()</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-39" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="4" data-code-annotation="3">We add 1 to the start of each year to account for how the legislative sessions all start in October, while the WhoGov data are updated each July.</span>
</dd>
</dl>
</div>
</div>
<p>We can now <code>left_join</code> <code>stortinget_female_share_by_period</code> and <code>share_female_ministers</code> using <code>year</code> as the <em>key</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>share_female_ministers_and_mps_by_year <span class="ot">&lt;-</span> <span class="fu">left_join</span>(stortinget_female_share_by_period, share_female_ministers, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(share_female_ministers_and_mps_by_year) <span class="sc">==</span> <span class="fu">nrow</span>(stortinget_female_share_by_period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>That worked. But let’s look at the result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(share_female_ministers_and_mps_by_year, <span class="at">n =</span> <span class="fu">nrow</span>(share_female_ministers_and_mps_by_year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
   period_id.x share_female_mps  year share_female_ministers period_id.y
   &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt;                  &lt;dbl&gt; &lt;chr&gt;      
 1 1945-49               0.0467  1946                 NA     &lt;NA&gt;       
 2 1950-53               0.0467  1951                 NA     &lt;NA&gt;       
 3 1954-57               0.0464  1955                 NA     &lt;NA&gt;       
 4 1958-61               0.0667  1959                 NA     &lt;NA&gt;       
 5 1961-65               0.0867  1962                 NA     &lt;NA&gt;       
 6 1965-69               0.08    1966                  0.133 1969-73    
 7 1969-73               0.0933  1970                  0.133 1969-73    
 8 1973-77               0.153   1974                  0.2   1973-77    
 9 1977-81               0.239   1978                  0.235 1977-81    
10 1981-85               0.258   1982                  0.235 1981-85    
11 1985-89               0.344   1986                  0.444 1985-89    
12 1989-93               0.358   1990                  0.421 1989-93    
13 1993-97               0.394   1994                  0.421 1993-97    
14 1997-2001             0.364   1998                  0.5   1997-2001  
15 2001-2005             0.364   2002                  0.421 2001-2005  
16 2005-2009             0.379   2006                  0.474 2005-2009  
17 2009-2013             0.396   2010                  0.476 2009-2013  
18 2013-2017             0.396   2014                  0.5   2013-2017  
19 2017-2021             0.408   2018                  0.45  2017-2021  
20 2021-2025             0.450   2022                 NA     &lt;NA&gt;       </code></pre>
</div>
</div>
<p>There are several things to note:</p>
<ol type="1">
<li>We no longer retain the yearly observations for the <code>share_female_ministers</code> variables. We retain only those years that exist in <code>stortinget_female_share_by_period$year</code>. If we wanted a dataset on the legislative period level, it would arguably have been better to create the <code>period_id</code> variable in the <code>who_gov_norway_ministers</code> dataset and calculate the share of female ministers within each period (this would again create additional questions concerning for instance if we wanted to adjust for how long each minister was in office. These things are not as straightforward as we might wish!).</li>
<li>We keep the periods for which there are no observations on <code>share_female_ministers</code>. <code>left_join()</code> will retain all observations in the “left” dataset. These observations get <code>NA</code> values on the variables from the dataset “to the right”.</li>
<li>We duplicated the <code>period_id</code> variable. Since this variable was present in both datasets and we didn’t use it as a key, <code>left_join()</code> has retained a copy of each and named them <code>period_id.x</code> and <code>period_id.y</code>. We could have avoided this by including the variable as part of the key (<code>by = c("year", "period_id")</code> or by omitting this variable from one of the dataset before joining them.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>right_join()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is, of course, also a <code>right_join()</code> which works exactly like <code>left_join</code>, except that it will keep all the observations in the second dataset (“the dataset to the right”) and add variables from the first dataset to this second dataset.</p>
</div>
</div>
</section>
<section id="inner_join" class="level3">
<h3 class="anchored" data-anchor-id="inner_join"><code>inner_join()</code></h3>
<p>We can also <code>inner_join()</code>, in which case we will only keep those variables that are present in both datasets. Consider:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>share_female_ministers_and_mps_by_year_inner <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(stortinget_female_share_by_period, share_female_ministers, </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"period_id"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(share_female_ministers_and_mps_by_year_inner, <span class="at">n =</span> <span class="fu">nrow</span>(share_female_ministers_and_mps_by_year_inner))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 4
   period_id share_female_mps  year share_female_ministers
   &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;                  &lt;dbl&gt;
 1 1969-73             0.0933  1970                  0.133
 2 1973-77             0.153   1974                  0.2  
 3 1977-81             0.239   1978                  0.235
 4 1981-85             0.258   1982                  0.235
 5 1985-89             0.344   1986                  0.444
 6 1989-93             0.358   1990                  0.421
 7 1993-97             0.394   1994                  0.421
 8 1997-2001           0.364   1998                  0.5  
 9 2001-2005           0.364   2002                  0.421
10 2005-2009           0.379   2006                  0.474
11 2009-2013           0.396   2010                  0.476
12 2013-2017           0.396   2014                  0.5  
13 2017-2021           0.408   2018                  0.45 </code></pre>
</div>
</div>
<p>The key difference is that we now omit all observations that are not present in both datasets!</p>
</section>
<section id="full_join" class="level3">
<h3 class="anchored" data-anchor-id="full_join"><code>full_join()</code></h3>
<p>We can instead <code>full_join()</code> to keep all observations that are present in at least one of the datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>share_female_ministers_and_mps_by_year_full <span class="ot">&lt;-</span> <span class="fu">full_join</span>(stortinget_female_share_by_period, share_female_ministers, </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"period_id"</span>))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(share_female_ministers_and_mps_by_year_full, <span class="at">n =</span> <span class="fu">nrow</span>(share_female_ministers_and_mps_by_year_full))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 63 × 4
   period_id share_female_mps  year share_female_ministers
   &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;                  &lt;dbl&gt;
 1 1945-49             0.0467  1946                NA     
 2 1950-53             0.0467  1951                NA     
 3 1954-57             0.0464  1955                NA     
 4 1958-61             0.0667  1959                NA     
 5 1961-65             0.0867  1962                NA     
 6 1965-69             0.08    1966                NA     
 7 1969-73             0.0933  1970                 0.133 
 8 1973-77             0.153   1974                 0.2   
 9 1977-81             0.239   1978                 0.235 
10 1981-85             0.258   1982                 0.235 
11 1985-89             0.344   1986                 0.444 
12 1989-93             0.358   1990                 0.421 
13 1993-97             0.394   1994                 0.421 
14 1997-2001           0.364   1998                 0.5   
15 2001-2005           0.364   2002                 0.421 
16 2005-2009           0.379   2006                 0.474 
17 2009-2013           0.396   2010                 0.476 
18 2013-2017           0.396   2014                 0.5   
19 2017-2021           0.408   2018                 0.45  
20 2021-2025           0.450   2022                NA     
21 2009-2013          NA       2013                 0.524 
22 2009-2013          NA       2012                 0.5   
23 2013-2017          NA       2015                 0.5   
24 2009-2013          NA       2011                 0.476 
25 1989-93            NA       1991                 0.474 
26 1989-93            NA       1992                 0.474 
27 2005-2009          NA       2007                 0.474 
28 1993-97            NA       1997                 0.45  
29 2005-2009          NA       2009                 0.45  
30 2013-2017          NA       2017                 0.45  
31 2017-2021          NA       2019                 0.45  
32 1985-89            NA       1987                 0.444 
33 1985-89            NA       1988                 0.444 
34 1985-89            NA       1989                 0.444 
35 2013-2017          NA       2016                 0.444 
36 2005-2009          NA       2008                 0.429 
37 1989-93            NA       1993                 0.421 
38 1993-97            NA       1995                 0.421 
39 1993-97            NA       1996                 0.421 
40 1997-2001          NA       2000                 0.421 
41 1997-2001          NA       2001                 0.421 
42 2001-2005          NA       2003                 0.421 
43 2001-2005          NA       2004                 0.421 
44 2001-2005          NA       2005                 0.421 
45 1997-2001          NA       1999                 0.4   
46 2017-2021          NA       2020                 0.4   
47 2017-2021          NA       2021                 0.4   
48 1973-77            NA       1976                 0.25  
49 1973-77            NA       1977                 0.25  
50 1977-81            NA       1979                 0.25  
51 1977-81            NA       1981                 0.25  
52 1981-85            NA       1983                 0.222 
53 1981-85            NA       1984                 0.222 
54 1981-85            NA       1985                 0.222 
55 1969-73            NA       1973                 0.2   
56 1973-77            NA       1975                 0.188 
57 1969-73            NA       1966                 0.133 
58 1969-73            NA       1967                 0.133 
59 1969-73            NA       1968                 0.133 
60 1969-73            NA       1969                 0.133 
61 1977-81            NA       1980                 0.125 
62 1969-73            NA       1971                 0.0667
63 1969-73            NA       1972                 0.0667</code></pre>
</div>
</div>
<p>When using <code>full_join()</code> we get all the combinations of <code>year</code> and <code>period_id</code> that are present in one of the datasets. We get <code>NA</code>s on the <code>share_female_ministers</code> if the observation doesn’t appear in the <code>share_female_ministers</code> dataset and <code>NA</code>s on the <code>share_female_mps</code> variable if the the observation doesn’t appear in the <code>stortinget_female_share_by_period</code> dataset.</p>
</section>
</section>
<section id="binding-data" class="level2">
<h2 class="anchored" data-anchor-id="binding-data">Binding data</h2>
<p>Imagine that instead of the having the <code>stortinget_female_share_by_period</code> dataset with the share of female members of parliament for each legislative period, we had multiple files each containing the share of female members of parliament in one particular legislative period. For instance, we may have a set of <code>.csv</code> files such as these:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-45"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-45" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-45-1" class="code-annotation-target"><a href="#annotated-cell-45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>(<span class="st">"../data/stortinget_periods"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-45" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-45" data-code-lines="1" data-code-annotation="1">The <code>dir()</code> function gives you the names of all the files in a specified directory on your computer.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "stortinget_female_share_1945_period.csv"
 [2] "stortinget_female_share_1950_period.csv"
 [3] "stortinget_female_share_1954_period.csv"
 [4] "stortinget_female_share_1958_period.csv"
 [5] "stortinget_female_share_1961_period.csv"
 [6] "stortinget_female_share_1965_period.csv"
 [7] "stortinget_female_share_1969_period.csv"
 [8] "stortinget_female_share_1973_period.csv"
 [9] "stortinget_female_share_1977_period.csv"
[10] "stortinget_female_share_1981_period.csv"
[11] "stortinget_female_share_1985_period.csv"
[12] "stortinget_female_share_1989_period.csv"
[13] "stortinget_female_share_1993_period.csv"
[14] "stortinget_female_share_1997_period.csv"
[15] "stortinget_female_share_2001_period.csv"
[16] "stortinget_female_share_2005_period.csv"
[17] "stortinget_female_share_2009_period.csv"
[18] "stortinget_female_share_2013_period.csv"
[19] "stortinget_female_share_2017_period.csv"
[20] "stortinget_female_share_2021_period.csv"</code></pre>
</div>
</div>
<p>Consider the files <code>stortinget_female_share_2017_period.csv"</code> and <code>stortinget_female_share_2021_period.csv</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>stortinget_female_share_2017_period <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"../data/stortinget_periods/stortinget_female_share_2017_period.csv"</span>, <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stortinget_female_share_2017_period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  period_id share_female_mps
  &lt;chr&gt;                &lt;dbl&gt;
1 2017-2021            0.408</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>stortinget_female_share_2021_period <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"../data/stortinget_periods/stortinget_female_share_2021_period.csv"</span>, <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stortinget_female_share_2021_period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  period_id share_female_mps
  &lt;chr&gt;                &lt;dbl&gt;
1 2021-2025            0.450</code></pre>
</div>
</div>
<p>Each of these files contain information about the same variables and with the same variable names. But there are different observations in each file. We cannot join them to combine these data, but we may bind the files together:</p>
<section id="bind_rows" class="level3">
<h3 class="anchored" data-anchor-id="bind_rows"><code>bind_rows()</code></h3>
<p>We we would want to add the rows from these different datasets on top of each other. We can do so using the <code>bind_rows()</code> function <code>dplyr</code>. You supply <code>bind_rows()</code> with two or more <code>data.frame</code>s which will be added on top of each other. The output will contain all columns that exist in at least one of the <code>data.frame</code>s and columns with the same names will be treated as the same variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>stortinget_female_share_2017_and_2021_periods <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(stortinget_female_share_2017_period, </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                                                           stortinget_female_share_2021_period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stortinget_female_share_2017_and_2021_periods)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  period_id share_female_mps
  &lt;chr&gt;                &lt;dbl&gt;
1 2017-2021            0.408
2 2021-2025            0.450</code></pre>
</div>
</div>
<section id="binding-many-datasets-together" class="level4">
<h4 class="anchored" data-anchor-id="binding-many-datasets-together">Binding many datasets together</h4>
<p>Of course, we may want to bind all the different <code>.csv</code>-files together. If so, it makes sense to exploit what we already know about <em>iteration</em> in R, for instance by writing a for-loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-50"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-50" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-50-1" class="code-annotation-target"><a href="#annotated-cell-50-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"../data/stortinget_periods"</span>, <span class="fu">dir</span>(<span class="st">"../data/stortinget_periods"</span>), <span class="at">sep =</span> <span class="st">"/"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-50" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-50-2" class="code-annotation-target"><a href="#annotated-cell-50-2" aria-hidden="true" tabindex="-1"></a>stortinget_female_share_combined <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-50" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-50-3" class="code-annotation-target"><a href="#annotated-cell-50-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> files){</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-50" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-50-4" class="code-annotation-target"><a href="#annotated-cell-50-4" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(i)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-50" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-50-5" class="code-annotation-target"><a href="#annotated-cell-50-5" aria-hidden="true" tabindex="-1"></a>  stortinget_female_share_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(stortinget_female_share_combined,</span>
<span id="annotated-cell-50-6"><a href="#annotated-cell-50-6" aria-hidden="true" tabindex="-1"></a>                                                tmp)</span>
<span id="annotated-cell-50-7"><a href="#annotated-cell-50-7" aria-hidden="true" tabindex="-1"></a>}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-50" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-50" data-code-lines="1" data-code-annotation="1">We start by creating a vector with the path to all the different <code>.csv</code>-files.</span>
</dd>
<dt data-target-cell="annotated-cell-50" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-50" data-code-lines="2" data-code-annotation="2">Next we create an empty <code>data.frame</code> that we will add the data to</span>
</dd>
<dt data-target-cell="annotated-cell-50" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-50" data-code-lines="3" data-code-annotation="3">We loop over the different <code>files</code></span>
</dd>
<dt data-target-cell="annotated-cell-50" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-50" data-code-lines="4" data-code-annotation="4">We read each file and assign it temporarily as <code>tmp</code></span>
</dd>
<dt data-target-cell="annotated-cell-50" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-50" data-code-lines="5,6" data-code-annotation="5">Finally, we bind <code>stortinget_female_share_combined</code> and <code>tmp</code> and assign the result to <code>stortinget_female_share_combined</code>. For each iteration we thus overwrite <code>stortinget_female_share_combined</code> making it longer.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stortinget_female_share_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   period_id share_female_mps
1    1945-49       0.04666667
2    1950-53       0.04666667
3    1954-57       0.04635762
4    1958-61       0.06666667
5    1961-65       0.08666667
6    1965-69       0.08000000
7    1969-73       0.09333333
8    1973-77       0.15286624
9    1977-81       0.23870968
10   1981-85       0.25806452
11   1985-89       0.34394904
12   1989-93       0.35757576
13   1993-97       0.39393939
14 1997-2001       0.36363636
15 2001-2005       0.36363636
16 2005-2009       0.37869822
17 2009-2013       0.39644970
18 2013-2017       0.39644970
19 2017-2021       0.40828402
20 2021-2025       0.44970414</code></pre>
</div>
</div>
<p>Alternatively we may use the <code>map()</code> and <code>reduce()</code> functions from <code>purrr</code> to do the same thing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-52"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-52-1"><a href="#annotated-cell-52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-52" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-52-2" class="code-annotation-target"><a href="#annotated-cell-52-2" aria-hidden="true" tabindex="-1"></a>stortinget_female_share_combined_with_purr <span class="ot">&lt;-</span> files <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-52" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-52-3" class="code-annotation-target"><a href="#annotated-cell-52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(read_csv) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-52" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-52-4" class="code-annotation-target"><a href="#annotated-cell-52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(bind_rows)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-52" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-52" data-code-lines="2" data-code-annotation="1">We use the <code>files</code> vector with the name and location of each <code>csv.</code>-file that we created above</span>
</dd>
<dt data-target-cell="annotated-cell-52" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-52" data-code-lines="3" data-code-annotation="2">With <code>map()</code> we can apply a function to all the elements in a vector. Here we apply <code>read_csv</code> which will load each file with a name and location in the <code>files</code> vector. This will produce a list containing the 20 <code>data.frame</code>s</span>
</dd>
<dt data-target-cell="annotated-cell-52" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-52" data-code-lines="4" data-code-annotation="3">We can use <code>reduce()</code> to combine the elements of a list or vector into a single value. Here we use <code>bind_rows()</code> to combine all the the elements of the list of 20 <code>data.frame</code>s into a single <code>data.frame</code></span>
</dd>
</dl>
</div>
</div>
<p>The result looks exactly the same as when we used a for-loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stortinget_female_share_combined_with_purr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 2
   period_id share_female_mps
   &lt;chr&gt;                &lt;dbl&gt;
 1 1945-49             0.0467
 2 1950-53             0.0467
 3 1954-57             0.0464
 4 1958-61             0.0667
 5 1961-65             0.0867
 6 1965-69             0.08  
 7 1969-73             0.0933
 8 1973-77             0.153 
 9 1977-81             0.239 
10 1981-85             0.258 
11 1985-89             0.344 
12 1989-93             0.358 
13 1993-97             0.394 
14 1997-2001           0.364 
15 2001-2005           0.364 
16 2005-2009           0.379 
17 2009-2013           0.396 
18 2013-2017           0.396 
19 2017-2021           0.408 
20 2021-2025           0.450 </code></pre>
</div>
</div>
<p>With only 20 files, neither of these solutions is significantly more efficient than the other. It’s a matter of taste. If you have a very large number of files, the <code>purrr</code> approach will likely be faster.</p>
</section>
</section>
<section id="bind_cols" class="level3">
<h3 class="anchored" data-anchor-id="bind_cols"><code>bind_cols()</code></h3>
<p>Just like we can <code>bind_rows()</code>, adding different datasets on top of each other, we can <code>bind_cols()</code>, adding different datasets together side by side.</p>
<p>For <code>bind_cols()</code> to be appropriate though, all the observations/rows need to be the same and be sorted in the same order in the <code>data.frame</code>s we are binding. When we are not absolutely confident that they are, it is better to use <code>left_join()</code> or one of the other “join”-functions.</p>
</section>
</section>
</section>
<section id="changing-the-structure-of-datasets-with-tidyr" class="level1">
<h1>Changing the structure of datasets with <code>tidyr</code></h1>
</section>
<section id="unite-and-separate" class="level1">
<h1><code>unite()</code> and <code>separate()</code></h1>
<p>In a tidy dataset, each cell should contain one value and each value should have its own cell. Sometimes, we will encounter data where multiple values are included in the same cell or maybe what for our purposes should be considered a a value is spread across multiple cells. In the former case, we would need to <code>separate()</code> the data. In the latter case, we would need to <code>unite()</code> the data. <code>unite()</code> and <code>separate</code> are both from the package <code>tidyr</code> (i.e.&nbsp;not from <code>dplyr</code>) so make sure that this package is loaded.</p>
<p>Lets’ consider an example.</p>
<p>The file “grand_chamber.RData” contains some information about Grand Chamber judgments of the European Court of Human Rights rendered between 1999 and 2018. Let’s load the data and use <code>head()</code> to get a sense of how it is structured.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/grand_chamber.RData"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(grand_chamber)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  file_name  title                                conclusions  year  month day  
  &lt;chr&gt;      &lt;chr&gt;                                &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 001-100413 McFARLANE v. IRELAND                 Preliminary… 2010  09    10   
2 001-100448 SANOMA UITGEVERS B.V. v. NETHERLANDS Violation o… 2010  09    14   
3 001-100686 MANGOURAS v. SPAIN                   No violatio… 2010  09    28   
4 001-101568 SAKHNOVSKIY v. RUSSIA                Preliminary… 2010  11    02   
5 001-101579 ŞERİFE YİĞİT v. TURKEY               Preliminary… 2010  11    02   
6 001-101739 TAXQUET v. BELGIUM                   Violation o… 2010  11    16   </code></pre>
</div>
</div>
<p>The dataset contains one row per Grand Chamber judgment. The different variables are the “file_name” which is a unique identifier of the judgment in the Court’s database system, the title of the case, the conclusion(s) of the judgment, and the year, month, and day on which the judgment was rendered.</p>
<section id="unite" class="level2">
<h2 class="anchored" data-anchor-id="unite"><code>unite()</code></h2>
<p>Remember that each variable should have one column only. For most applications, it doesn’t make sense to think of the year, month, and day on which the judgment was rendered (unless your theory is that judges get more grumpy in particular months or something like that). Instead, we would want a single variable capturing the date of the judgment!</p>
<p>To get a date variable we need to <code>unite()</code> the <code>year</code>, <code>month</code> and <code>day</code> columns.</p>
<p>For the <code>unite()</code> function we need to specify the name of the new column we would like to create. We then list all the columns we would like to <code>unite()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-55"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-55-1"><a href="#annotated-cell-55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-55" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-55-2" class="code-annotation-target"><a href="#annotated-cell-55-2" aria-hidden="true" tabindex="-1"></a>grand_chamber <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-55" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-55-3" class="code-annotation-target"><a href="#annotated-cell-55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(judgment_date, year, month, day) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-55" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-55-4" class="code-annotation-target"><a href="#annotated-cell-55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-55" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-55" data-code-lines="2" data-code-annotation="1">We are not assigning it to a new object, because we just want to test how this works. We therefore prefer to just print the result to the console.</span>
</dd>
<dt data-target-cell="annotated-cell-55" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-55" data-code-lines="3" data-code-annotation="2">We want the new column “judgment_date” based on uniting “year”, “month”, and “day”</span>
</dd>
<dt data-target-cell="annotated-cell-55" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-55" data-code-lines="4" data-code-annotation="3">We use head() to get a quick look of what the above code produces</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  file_name  title                                conclusions      judgment_date
  &lt;chr&gt;      &lt;chr&gt;                                &lt;chr&gt;            &lt;chr&gt;        
1 001-100413 McFARLANE v. IRELAND                 Preliminary obj… 2010_09_10   
2 001-100448 SANOMA UITGEVERS B.V. v. NETHERLANDS Violation of Ar… 2010_09_14   
3 001-100686 MANGOURAS v. SPAIN                   No violation of… 2010_09_28   
4 001-101568 SAKHNOVSKIY v. RUSSIA                Preliminary obj… 2010_11_02   
5 001-101579 ŞERİFE YİĞİT v. TURKEY               Preliminary obj… 2010_11_02   
6 001-101739 TAXQUET v. BELGIUM                   Violation of Ar… 2010_11_16   </code></pre>
</div>
</div>
<p>The above code removed the columns <code>year</code>, <code>month</code>, and <code>day</code> and replaced them with the new column <code>judgment_date</code>. The new column looks almost like what we want, but we see that years, months, and days are separated by underscores (<code>_</code>). This is not really a common way to format dates. We might want to replace the underscores (<code>_</code>) with hyphens (<code>-</code>). If so, we can specify the <code>sep</code> argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-56"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-56-1"><a href="#annotated-cell-56-1" aria-hidden="true" tabindex="-1"></a>grand_chamber <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-56" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-56-2" class="code-annotation-target"><a href="#annotated-cell-56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(judgment_date, year, month, day, <span class="at">sep =</span> <span class="st">"-"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-56-3"><a href="#annotated-cell-56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-56" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-56" data-code-lines="2" data-code-annotation="1">We specify that values on the old columns should be separated with <code>-</code> on the new column.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  file_name  title                                conclusions      judgment_date
  &lt;chr&gt;      &lt;chr&gt;                                &lt;chr&gt;            &lt;chr&gt;        
1 001-100413 McFARLANE v. IRELAND                 Preliminary obj… 2010-09-10   
2 001-100448 SANOMA UITGEVERS B.V. v. NETHERLANDS Violation of Ar… 2010-09-14   
3 001-100686 MANGOURAS v. SPAIN                   No violation of… 2010-09-28   
4 001-101568 SAKHNOVSKIY v. RUSSIA                Preliminary obj… 2010-11-02   
5 001-101579 ŞERİFE YİĞİT v. TURKEY               Preliminary obj… 2010-11-02   
6 001-101739 TAXQUET v. BELGIUM                   Violation of Ar… 2010-11-16   </code></pre>
</div>
</div>
<p>The dates are now formatted in a a reasonable way.</p>
<p>Notice that by default, the old columns are removed. If we don’t want to remove the <code>year</code>, <code>month</code>, and <code>day</code> columns, we can set <code>remove = FALSE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-57"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-57-1"><a href="#annotated-cell-57-1" aria-hidden="true" tabindex="-1"></a>grand_chamber <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-57" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-57-2" class="code-annotation-target"><a href="#annotated-cell-57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(judgment_date, year, month, day, <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-57-3"><a href="#annotated-cell-57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-57" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-57" data-code-lines="2" data-code-annotation="1">setting <code>remove = FALSE</code> in order to retain the input columns.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  file_name  title                   conclusions judgment_date year  month day  
  &lt;chr&gt;      &lt;chr&gt;                   &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 001-100413 McFARLANE v. IRELAND    Preliminar… 2010-09-10    2010  09    10   
2 001-100448 SANOMA UITGEVERS B.V. … Violation … 2010-09-14    2010  09    14   
3 001-100686 MANGOURAS v. SPAIN      No violati… 2010-09-28    2010  09    28   
4 001-101568 SAKHNOVSKIY v. RUSSIA   Preliminar… 2010-11-02    2010  11    02   
5 001-101579 ŞERİFE YİĞİT v. TURKEY  Preliminar… 2010-11-02    2010  11    02   
6 001-101739 TAXQUET v. BELGIUM      Violation … 2010-11-16    2010  11    16   </code></pre>
</div>
</div>
<p>To save the result to the <code>grand_chamber</code> dataset, we need to assign the result back to the <code>data.frame</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>grand_chamber <span class="ot">&lt;-</span> grand_chamber <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(judgment_date, year, month, day, <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(grand_chamber)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  file_name  title                   conclusions judgment_date year  month day  
  &lt;chr&gt;      &lt;chr&gt;                   &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 001-100413 McFARLANE v. IRELAND    Preliminar… 2010-09-10    2010  09    10   
2 001-100448 SANOMA UITGEVERS B.V. … Violation … 2010-09-14    2010  09    14   
3 001-100686 MANGOURAS v. SPAIN      No violati… 2010-09-28    2010  09    28   
4 001-101568 SAKHNOVSKIY v. RUSSIA   Preliminar… 2010-11-02    2010  11    02   
5 001-101579 ŞERİFE YİĞİT v. TURKEY  Preliminar… 2010-11-02    2010  11    02   
6 001-101739 TAXQUET v. BELGIUM      Violation … 2010-11-16    2010  11    16   </code></pre>
</div>
</div>
</section>
<section id="separate" class="level2">
<h2 class="anchored" data-anchor-id="separate"><code>separate()</code></h2>
<p>Consider the variable <code>grand_chamber$title</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>grand_chamber<span class="sc">$</span>title[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "McFARLANE v. IRELAND"                
 [2] "SANOMA UITGEVERS B.V. v. NETHERLANDS"
 [3] "MANGOURAS v. SPAIN"                  
 [4] "SAKHNOVSKIY v. RUSSIA"               
 [5] "ŞERİFE YİĞİT v. TURKEY"              
 [6] "TAXQUET v. BELGIUM"                  
 [7] "PERDIGAO v. PORTUGAL"                
 [8] "A, B AND C v. IRELAND"               
 [9] "PAKSAS v. LITHUANIA"                 
[10] "M.S.S. v. BELGIUM, GREECE"           </code></pre>
</div>
</div>
<p>The case name contains the name of the applicant(s) in the case (the people claiming that their human rights have been violated) and the name of the respondent state(s) separated by “.v”. Suppose we are interested in having the applicant(s) and the respondent state(s) in separate variables. For instance, we might be interested in learning how many cases there are against different states.</p>
<p>We need to <code>separate()</code> the column “title” into two new columns, which we may call “applicant” and “respondent_state”. We can exploit the fact that these two pieces of the data are always separated by the a “v.” in the “title” column. We need to specify (1) the column we would like to <code>separate()</code> using the <code>col</code> argument, (2) the columns it should be separated into using the <code>into</code> argument, which takes a character vector with the new column names, and (3) the separator, using the <code>sep</code> argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-60"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-60-1"><a href="#annotated-cell-60-1" aria-hidden="true" tabindex="-1"></a>grand_chamber <span class="sc">%&gt;%</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-60" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-60-2" class="code-annotation-target"><a href="#annotated-cell-60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> title,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-60" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-60-3" class="code-annotation-target"><a href="#annotated-cell-60-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"applicant"</span>, <span class="st">"respondent_state"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-60" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-60-4" class="code-annotation-target"><a href="#annotated-cell-60-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"v. "</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-60-5"><a href="#annotated-cell-60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-60" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-60" data-code-lines="2" data-code-annotation="1"><code>title</code> is the column we would like to separate</span>
</dd>
<dt data-target-cell="annotated-cell-60" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-60" data-code-lines="3" data-code-annotation="2">“applicant” and “respondent_state” are the names of the new columns that <code>title</code> should be separated into.</span>
</dd>
<dt data-target-cell="annotated-cell-60" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-60" data-code-lines="4" data-code-annotation="3">The separator is “v.”.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  file_name  applicant    respondent_state conclusions judgment_date year  month
  &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;
1 001-100413 "McFARLANE " IRELAND          Preliminar… 2010-09-10    2010  09   
2 001-100448 "SANOMA UIT… NETHERLANDS      Violation … 2010-09-14    2010  09   
3 001-100686 "MANGOURAS " SPAIN            No violati… 2010-09-28    2010  09   
4 001-101568 "SAKHNOVSKI… RUSSIA           Preliminar… 2010-11-02    2010  11   
5 001-101579 "ŞERİFE YİĞ… TURKEY           Preliminar… 2010-11-02    2010  11   
6 001-101739 "TAXQUET "   BELGIUM          Violation … 2010-11-16    2010  11   
# ℹ 1 more variable: day &lt;chr&gt;</code></pre>
</div>
</div>
<p>We now got two new columns <code>applicant</code> and <code>respondent_state</code>. Like for <code>unite()</code> the default behavior is to remove the old column. In this case, it probably makes sense to keep the title though, so we will override this behavior using the <code>remove</code> argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>grand_chamber <span class="ot">&lt;-</span> grand_chamber <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> title,  </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"applicant"</span>, <span class="st">"respondent_state"</span>), </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"v. "</span>, </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(grand_chamber)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  file_name  title    applicant respondent_state conclusions judgment_date year 
  &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;
1 001-100413 McFARLA… "McFARLA… IRELAND          Preliminar… 2010-09-10    2010 
2 001-100448 SANOMA … "SANOMA … NETHERLANDS      Violation … 2010-09-14    2010 
3 001-100686 MANGOUR… "MANGOUR… SPAIN            No violati… 2010-09-28    2010 
4 001-101568 SAKHNOV… "SAKHNOV… RUSSIA           Preliminar… 2010-11-02    2010 
5 001-101579 ŞERİFE … "ŞERİFE … TURKEY           Preliminar… 2010-11-02    2010 
6 001-101739 TAXQUET… "TAXQUET… BELGIUM          Violation … 2010-11-16    2010 
# ℹ 2 more variables: month &lt;chr&gt;, day &lt;chr&gt;</code></pre>
</div>
</div>
<section id="separate-when-the-number-of-values-differ-between-rows" class="level3">
<h3 class="anchored" data-anchor-id="separate-when-the-number-of-values-differ-between-rows"><code>separate()</code> when the number of values differ between rows</h3>
<p>Let’s tabulate the <code>grandchamber$respondent_state</code> variable, we just created:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(grand_chamber<span class="sc">$</span>respondent_state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                                                           ARMENIA 
                                                                 3 
                                                           AUSTRIA 
                                                                 4 
                                                        AZERBAIJAN 
                                                                 2 
                                                           BELGIUM 
                                                                 9 
                                                   BELGIUM, GREECE 
                                                                 1 
                                            BOSNIA AND HERZEGOVINA 
                                                                 3 
BOSNIA AND HERZEGOVINA, CROATIA, SERBIA, SLOVENIA, NORTH MACEDONIA 
                                                                 1 
                                                          BULGARIA 
                                                                 5 
                                                           CROATIA 
                                                                 7 
                                                            CYPRUS 
                                                                 4 
                                                    CZECH REPUBLIC 
                                                                 5 
                                                           DENMARK 
                                                                 4 
                                                           ESTONIA 
                                                                 1 
                                                           FINLAND 
                                                                 6 
                                                            FRANCE 
                                                                37 
                                                           GEORGIA 
                                                                 2 
                                                           GERMANY 
                                                                19 
                                                            GREECE 
                                                                15 
                                                           HUNGARY 
                                                                 8 
                                                           IRELAND 
                                                                 5 
                                                             ITALY 
                                                                46 
                                                            LATVIA 
                                                                12 
                                                     LIECHTENSTEIN 
                                                                 1 
                                                         LITHUANIA 
                                                                 5 
                                                        LUXEMBOURG 
                                                                 1 
                                                             MALTA 
                                                                 3 
                                                           MOLDOVA 
                                                                 4 
                                                   MOLDOVA, RUSSIA 
                                                                 3 
                                                       NETHERLANDS 
                                                                12 
                                                   NORTH MACEDONIA 
                                                                 1 
                                                            NORWAY 
                                                                 4 
                                                            POLAND 
                                                                10 
                                                          PORTUGAL 
                                                                 7 
                                                           ROMANIA 
                                                                14 
                                                            RUSSIA 
                                                                16 
                                                        SAN MARINO 
                                                                 1 
                                                            SERBIA 
                                                                 1 
                                                          SLOVAKIA 
                                                                 1 
                                                          SLOVENIA 
                                                                 5 
                                                             SPAIN 
                                                                 5 
                                                            SWEDEN 
                                                                 6 
                                                       SWITZERLAND 
                                                                14 
                                                            TURKEY 
                                                                42 
                                                           UKRAINE 
                                                                 3 
                                                    UNITED KINGDOM 
                                                                55 </code></pre>
</div>
</div>
<p>As you can see most, judgments had a single respondent state, but a few had two, and one judgment had five respondent states (“BOSNIA AND HERZEGOVINA, CROATIA, SERBIA, SLOVENIA, NORTH MACEDONIA”). We might want to separate these into different columns and, if so, we can exploit the fact that different states are separated by commas. The problem is we don’t have the same number of respondent states for all the rows. Fortunately, <code>separate()</code> can easily deal with this problem by filling in <code>NA</code> for rows with less than five respondent states. We just need to specify that we want <code>NA</code>s to be filled in to the right of the columns with</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-63"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-63-1"><a href="#annotated-cell-63-1" aria-hidden="true" tabindex="-1"></a>grand_chamber <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-63-2"><a href="#annotated-cell-63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> respondent_state, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-63" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-63-3" class="code-annotation-target"><a href="#annotated-cell-63-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">paste</span>(<span class="st">"respondent_state"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="annotated-cell-63-4"><a href="#annotated-cell-63-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">","</span>, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-63" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-63-5" class="code-annotation-target"><a href="#annotated-cell-63-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-63-6"><a href="#annotated-cell-63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-63" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-63" data-code-lines="3" data-code-annotation="1"><code>paste("respondent_state", 1:5, sep = "_")</code> will produce the list of column names we want. If you run <code>paste("respondent_state", 1:5, sep = "_")</code>, you get <code>"respondent_state_1" "respondent_state_2" "respondent_state_3" "respondent_state_4" "respondent_state_5"</code>, which is what we want.</span>
</dd>
<dt data-target-cell="annotated-cell-63" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-63" data-code-lines="5" data-code-annotation="2">We just need to specify where the <code>NA</code> should be added.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  file_name  title               applicant respondent_state_1 respondent_state_2
  &lt;chr&gt;      &lt;chr&gt;               &lt;chr&gt;     &lt;chr&gt;              &lt;chr&gt;             
1 001-100413 McFARLANE v. IRELA… "McFARLA… IRELAND            &lt;NA&gt;              
2 001-100448 SANOMA UITGEVERS B… "SANOMA … NETHERLANDS        &lt;NA&gt;              
3 001-100686 MANGOURAS v. SPAIN  "MANGOUR… SPAIN              &lt;NA&gt;              
4 001-101568 SAKHNOVSKIY v. RUS… "SAKHNOV… RUSSIA             &lt;NA&gt;              
5 001-101579 ŞERİFE YİĞİT v. TU… "ŞERİFE … TURKEY             &lt;NA&gt;              
6 001-101739 TAXQUET v. BELGIUM  "TAXQUET… BELGIUM            &lt;NA&gt;              
# ℹ 8 more variables: respondent_state_3 &lt;chr&gt;, respondent_state_4 &lt;chr&gt;,
#   respondent_state_5 &lt;chr&gt;, conclusions &lt;chr&gt;, judgment_date &lt;chr&gt;,
#   year &lt;chr&gt;, month &lt;chr&gt;, day &lt;chr&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="separate_longer_delim" class="level2">
<h2 class="anchored" data-anchor-id="separate_longer_delim"><code>separate_longer_delim()</code></h2>
<p>Rather than having multiple <code>respondent_state</code> variables, it might make sense to change the data structure so that we have one row per judgment per respondent state. If so, we can use <code>separate_longer_delim()</code>. This function works like <code>separate</code> but instead of splitting the column supplied to <code>col</code> into multiple columns, it will add addition rows so that each row has a single value on <code>col</code> column. For instance, we may:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-64"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-64-1"><a href="#annotated-cell-64-1" aria-hidden="true" tabindex="-1"></a>grand_chamber_per_state <span class="ot">&lt;-</span> grand_chamber <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-64-2"><a href="#annotated-cell-64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_longer_delim</span>(<span class="at">col =</span> respondent_state, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-64" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-64-3" class="code-annotation-target"><a href="#annotated-cell-64-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="annotated-cell-64-4"><a href="#annotated-cell-64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-64-5"><a href="#annotated-cell-64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(grand_chamber_per_state<span class="sc">$</span>respondent_state)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-64" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-64" data-code-lines="3" data-code-annotation="1">Note that <code>separate_longer_delim</code> uses the argument <code>delim</code> instead of <code>sep</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
               CROATIA                 GREECE        NORTH MACEDONIA 
                     1                      1                      1 
                RUSSIA                 SERBIA               SLOVENIA 
                     3                      1                      1 
               ARMENIA                AUSTRIA             AZERBAIJAN 
                     3                      4                      2 
               BELGIUM BOSNIA AND HERZEGOVINA               BULGARIA 
                    10                      4                      5 
               CROATIA                 CYPRUS         CZECH REPUBLIC 
                     7                      4                      5 
               DENMARK                ESTONIA                FINLAND 
                     4                      1                      6 
                FRANCE                GEORGIA                GERMANY 
                    37                      2                     19 
                GREECE                HUNGARY                IRELAND 
                    15                      8                      5 
                 ITALY                 LATVIA          LIECHTENSTEIN 
                    46                     12                      1 
             LITHUANIA             LUXEMBOURG                  MALTA 
                     5                      1                      3 
               MOLDOVA            NETHERLANDS        NORTH MACEDONIA 
                     7                     12                      1 
                NORWAY                 POLAND               PORTUGAL 
                     4                     10                      7 
               ROMANIA                 RUSSIA             SAN MARINO 
                    14                     16                      1 
                SERBIA               SLOVAKIA               SLOVENIA 
                     1                      1                      5 
                 SPAIN                 SWEDEN            SWITZERLAND 
                     5                      6                     14 
                TURKEY                UKRAINE         UNITED KINGDOM 
                    42                      3                     55 </code></pre>
</div>
</div>
<p>Each row now only has a single value in the <code>respondent_state</code>. While this is a nice way to structure these data, a key thing to remember is that we have now changed the observational unit from “judgment” to “judgment*respondent”.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>separate_wider_delim()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is also a <code>separate_wider_delim()</code> which works in the same way as the regular <code>separate()</code> function we have already discussed: it separates into multiple columns. The key difference is that it uses the argument <code>delim</code> instead of <code>sep</code>. The intention of the <code>tidyr</code> developers is that this function will replace <code>separate()</code>.</p>
</div>
</div>
</section>
</section>
<section id="pivoting-also-called-reshaping-your-data" class="level1">
<h1>Pivoting (also called “reshaping”) your data</h1>
<p>It’s time to deliver on the promise of tidying up the <a href="https://pages.github.uio.no/oyvinsti/STV4030A/Wrangling/tidy_data.html">World Bank population data that we introduced here</a>. Let’s reload this file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>wb_population_data <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"../data/WBpopulation.csv"</span>, <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wb_population_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 66
  `Series Name`     `Series Code` `Country Name` `Country Code` `1960 [YR1960]`
  &lt;chr&gt;             &lt;chr&gt;         &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;          
1 Population, total SP.POP.TOTL   Afghanistan    AFG            8622466        
2 Population, total SP.POP.TOTL   Albania        ALB            1608800        
3 Population, total SP.POP.TOTL   Algeria        DZA            11394307       
4 Population, total SP.POP.TOTL   American Samoa ASM            20085          
5 Population, total SP.POP.TOTL   Andorra        AND            9443           
6 Population, total SP.POP.TOTL   Angola         AGO            5357195        
# ℹ 61 more variables: `1961 [YR1961]` &lt;chr&gt;, `1962 [YR1962]` &lt;chr&gt;,
#   `1963 [YR1963]` &lt;chr&gt;, `1964 [YR1964]` &lt;chr&gt;, `1965 [YR1965]` &lt;chr&gt;,
#   `1966 [YR1966]` &lt;chr&gt;, `1967 [YR1967]` &lt;chr&gt;, `1968 [YR1968]` &lt;chr&gt;,
#   `1969 [YR1969]` &lt;chr&gt;, `1970 [YR1970]` &lt;chr&gt;, `1971 [YR1971]` &lt;chr&gt;,
#   `1972 [YR1972]` &lt;chr&gt;, `1973 [YR1973]` &lt;chr&gt;, `1974 [YR1974]` &lt;chr&gt;,
#   `1975 [YR1975]` &lt;chr&gt;, `1976 [YR1976]` &lt;chr&gt;, `1977 [YR1977]` &lt;chr&gt;,
#   `1978 [YR1978]` &lt;chr&gt;, `1979 [YR1979]` &lt;chr&gt;, `1980 [YR1980]` &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>The variable names are somewhat inconvenient, so before proceeding, we will quickly change the variable names using <code>clean_names()</code> from the <code>janitor</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-66"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-66-1"><a href="#annotated-cell-66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="annotated-cell-66-2"><a href="#annotated-cell-66-2" aria-hidden="true" tabindex="-1"></a>wb_population_data <span class="ot">&lt;-</span> wb_population_data <span class="sc">%&gt;%</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-66" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-66-3" class="code-annotation-target"><a href="#annotated-cell-66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="annotated-cell-66-4"><a href="#annotated-cell-66-4" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-66" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-66-5" class="code-annotation-target"><a href="#annotated-cell-66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(wb_population_data)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-66" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-66" data-code-lines="3" data-code-annotation="1"><code>clean_names()</code>changes the variable names so that they only consist of letters, numbers, and underscores and all names start with a letter. By default the new names follow our preferred “snake_case” convention, but you can change this using the <code>case</code> argument if you prefer to follow a different naming convention.<br>
</span>
</dd>
<dt data-target-cell="annotated-cell-66" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-66" data-code-lines="5" data-code-annotation="2">Printing out the new column names</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "series_name"  "series_code"  "country_name" "country_code" "x1960_yr1960"
 [6] "x1961_yr1961" "x1962_yr1962" "x1963_yr1963" "x1964_yr1964" "x1965_yr1965"
[11] "x1966_yr1966" "x1967_yr1967" "x1968_yr1968" "x1969_yr1969" "x1970_yr1970"
[16] "x1971_yr1971" "x1972_yr1972" "x1973_yr1973" "x1974_yr1974" "x1975_yr1975"
[21] "x1976_yr1976" "x1977_yr1977" "x1978_yr1978" "x1979_yr1979" "x1980_yr1980"
[26] "x1981_yr1981" "x1982_yr1982" "x1983_yr1983" "x1984_yr1984" "x1985_yr1985"
[31] "x1986_yr1986" "x1987_yr1987" "x1988_yr1988" "x1989_yr1989" "x1990_yr1990"
[36] "x1991_yr1991" "x1992_yr1992" "x1993_yr1993" "x1994_yr1994" "x1995_yr1995"
[41] "x1996_yr1996" "x1997_yr1997" "x1998_yr1998" "x1999_yr1999" "x2000_yr2000"
[46] "x2001_yr2001" "x2002_yr2002" "x2003_yr2003" "x2004_yr2004" "x2005_yr2005"
[51] "x2006_yr2006" "x2007_yr2007" "x2008_yr2008" "x2009_yr2009" "x2010_yr2010"
[56] "x2011_yr2011" "x2012_yr2012" "x2013_yr2013" "x2014_yr2014" "x2015_yr2015"
[61] "x2016_yr2016" "x2017_yr2017" "x2018_yr2018" "x2019_yr2019" "x2020_yr2020"
[66] "x2021_yr2021"</code></pre>
</div>
</div>
<p>The <strong>main problem</strong>, is, however, that the dataset is not in a tidy format. Each row refers to multiple different years and population variable is spread across multiple columns. Using <code>tidyr</code> we can, however, <em>pivot</em> or <em>reshape</em> the dataset into a tidy format.</p>
<section id="pivot_longer" class="level2">
<h2 class="anchored" data-anchor-id="pivot_longer"><code>pivot_longer()</code></h2>
<p>In other words, the main problem problem with <code>wb_population_data</code> is that is in a too <a href="https://en.wikipedia.org/wiki/Wide_and_narrow_data"><em>wide</em> format</a>. We need to increase the number of rows and decrease the number of columns, thus making the data <em>longer</em>.</p>
<p>We can do this using <em>pivot_longer()</em> from <em>tidyr</em>. We want to gather all the columns with names that start with “x” into one column and call that column <code>population</code>. We will also take the column names for all the variables that start with “x” and add them to a new variable, which we will call <code>year</code> so that we can keep track of which year each population value is for. [As we showed you above], we can use the <code>select()</code> helper function <code>starts_with()</code> to select all the columns that with names that start with the same character(s):</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-67"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-67-1"><a href="#annotated-cell-67-1" aria-hidden="true" tabindex="-1"></a>wb_population_tidy <span class="ot">&lt;-</span> wb_population_data <span class="sc">%&gt;%</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-67" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-67-2" class="code-annotation-target"><a href="#annotated-cell-67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"x"</span>),</span>
<span id="annotated-cell-67-3"><a href="#annotated-cell-67-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> as.numeric)) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-67" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-67-4" class="code-annotation-target"><a href="#annotated-cell-67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"x"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-67" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-67-5" class="code-annotation-target"><a href="#annotated-cell-67-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-67" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-67-6" class="code-annotation-target"><a href="#annotated-cell-67-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"population"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-67" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-67" data-code-lines="2,3" data-code-annotation="1">First we want to make sure that all these columns are of the same data type. Otherwise they cannot be combined. We use <code>mutate()</code> and <code>across()</code> to change multiple columns. We use <code>starts_with("x")</code> to select all columns with names that start with “x” as the columns we would like to change, and we specify that <code>as.numeric</code> is the function we would like to apply.</span>
</dd>
<dt data-target-cell="annotated-cell-67" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-67" data-code-lines="4" data-code-annotation="2">To <code>pivot_longer()</code>, we first need to select the columns that should be combined into a single variable using the <code>col</code> argument. Again we use <code>starts_with("x")</code> to select all columns with names that start with “x”.</span>
</dd>
<dt data-target-cell="annotated-cell-67" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-67" data-code-lines="5" data-code-annotation="3">We then specify the name for the new variable containing the column names for all those columns with names starting with “x”. The information that is useful in those column names is what year the value is for, so we will call this variable “year”</span>
</dd>
<dt data-target-cell="annotated-cell-67" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-67" data-code-lines="6" data-code-annotation="4">For <code>values_to</code> we specify the name for the new and longer variables that we want to add all the values on the different columns we are pivoting.</span>
</dd>
</dl>
</div>
</div>
<p>The first rows of the result look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wb_population_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  series_name       series_code country_name country_code year        population
  &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;            &lt;dbl&gt;
1 Population, total SP.POP.TOTL Afghanistan  AFG          x1960_yr19…    8622466
2 Population, total SP.POP.TOTL Afghanistan  AFG          x1961_yr19…    8790140
3 Population, total SP.POP.TOTL Afghanistan  AFG          x1962_yr19…    8969047
4 Population, total SP.POP.TOTL Afghanistan  AFG          x1963_yr19…    9157465
5 Population, total SP.POP.TOTL Afghanistan  AFG          x1964_yr19…    9355514
6 Population, total SP.POP.TOTL Afghanistan  AFG          x1965_yr19…    9565147</code></pre>
</div>
</div>
<p>Of course, the <code>year</code> variable doesn’t look like exactly what we want. But we already learned about the <code>substr()</code> function, which handles this slight complication:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>wb_population_tidy <span class="ot">&lt;-</span> wb_population_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substr</span>(year, <span class="dv">2</span>,<span class="dv">5</span>), </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">as.integer</span>(year))</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wb_population_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  series_name       series_code country_name country_code  year population
  &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;        &lt;int&gt;      &lt;dbl&gt;
1 Population, total SP.POP.TOTL Afghanistan  AFG           1960    8622466
2 Population, total SP.POP.TOTL Afghanistan  AFG           1961    8790140
3 Population, total SP.POP.TOTL Afghanistan  AFG           1962    8969047
4 Population, total SP.POP.TOTL Afghanistan  AFG           1963    9157465
5 Population, total SP.POP.TOTL Afghanistan  AFG           1964    9355514
6 Population, total SP.POP.TOTL Afghanistan  AFG           1965    9565147</code></pre>
</div>
</div>
</section>
<section id="pivot_wider" class="level2">
<h2 class="anchored" data-anchor-id="pivot_wider"><code>pivot_wider()</code></h2>
<p>Just like you may <code>pivot_longer</code>, you may <code>pivot_wider()</code> reducing the number of rows and expanding the number of columns. Consider this dataset which contains country-year data on different democracy indeces from the <a href="https://v-dem.net/">Varieties of Democracy project</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>democracy_scores <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"../data/democracy_scores.csv"</span>, <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(democracy_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  country_name country_id  year democracy_index  score
  &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
1 Mexico                3  1789 v2x_libdem       0.042
2 Mexico                3  1789 v2x_polyarchy    0.028
3 Mexico                3  1789 v2x_partipdem    0.006
4 Mexico                3  1789 v2x_egaldem     NA    
5 Mexico                3  1790 v2x_libdem       0.042
6 Mexico                3  1790 v2x_polyarchy    0.028</code></pre>
</div>
</div>
<p>Instead of one row per country-year, the dataset has one row per democracy index per country-year. This format can sometimes be useful for <a href="https://pages.github.uio.no/oyvinsti/STV4030A/Visualization/data_viz_in_ggplot.html">data visualization in ggplot2</a>, but it is inappropriate for doing country-year level analysis. We need to <code>pivot_wider()</code> the dataset.</p>
<p>To <code>pivot_wider()</code>, we need to specify the column in the existing dataset that contains the names of the new columns we will create to widen the data (the <code>names_from</code> argument) and the column in the existing dataset where the values on the new columns in the wider dataset should come from (the <code>values_from</code> argument):</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-71"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-71-1"><a href="#annotated-cell-71-1" aria-hidden="true" tabindex="-1"></a>democracy_scores_country_year <span class="ot">&lt;-</span> democracy_scores <span class="sc">%&gt;%</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-71" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-71-2" class="code-annotation-target"><a href="#annotated-cell-71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"democracy_index"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-71" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-71-3" class="code-annotation-target"><a href="#annotated-cell-71-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">"score"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-71" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-71" data-code-lines="2" data-code-annotation="1">The names of the new columns should come from the column <code>democracy_index</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-71" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-71" data-code-lines="3" data-code-annotation="2">The values for the new columns should come the column <code>score</code>.</span>
</dd>
</dl>
</div>
</div>
<p>The top rows of the new <code>data.frame</code> look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(democracy_scores_country_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  country_name country_id  year v2x_libdem v2x_polyarchy v2x_partipdem
  &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
1 Mexico                3  1789      0.042         0.028         0.006
2 Mexico                3  1790      0.042         0.028         0.006
3 Mexico                3  1791      0.042         0.028         0.006
4 Mexico                3  1792      0.042         0.028         0.006
5 Mexico                3  1793      0.042         0.028         0.006
6 Mexico                3  1794      0.042         0.028         0.006
# ℹ 1 more variable: v2x_egaldem &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We successfully pivoted the data into a country-year format!</p>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-arel2018countrycode" class="csl-entry" role="listitem">
Arel-Bundock, Vincent, Nils Enevoldsen, and CJ Yetman. 2018. <span>“Countrycode: An <span>R</span> Package to Convert Country Names and Country Codes.”</span> <em>Journal of Open Source Software</em> 3 (28): 848.
</div>
<div id="ref-gleditsch1999revised" class="csl-entry" role="listitem">
Gleditsch, Kristian S, and Michael D Ward. 1999. <span>“A Revised List of Independent States Since the Congress of Vienna.”</span> <em>International Interactions</em> 25 (4): 393–413.
</div>
<div id="ref-nyrup2020governs" class="csl-entry" role="listitem">
Nyrup, Jacob, and Stuart Bramwell. 2020. <span>“Who Governs? A New Global Dataset on Members of Cabinets.”</span> <em>American Political Science Review</em> 114 (4): 1366–74.
</div>
<div id="ref-nyrup2023consolidating" class="csl-entry" role="listitem">
Nyrup, Jacob, Hikaru Yamagishi, and Stuart Bramwell. 2023. <span>“Consolidating Progress: The Selection of Female Ministers in Autocracies and Democracies.”</span> <em>American Political Science Review</em>, 1–20.
</div>
<div id="ref-soyland2017survival" class="csl-entry" role="listitem">
Søyland, Martin. 2017. <span>“Survival of the Ministers: On Ministerial Durability in Postwar Norway.”</span> <em>Scandinavian Political Studies</em> 40 (2): 182–206.
</div>
<div id="ref-soyland2021stortingscrape" class="csl-entry" role="listitem">
———. 2021. <span>“Stortingscrape: An r Package for Accessing Data from the Norwegian Parliament.”</span>
</div>
<div id="ref-wickham2023r" class="csl-entry" role="listitem">
Wickham, Hadley, Mine Çetinkaya-Rundel, and Garrett Grolemund. 2023. <em>R for Data Science</em>. 2nd edition. " O’Reilly Media, Inc.".
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Or at least we know how to use <a href="https://no.wikipedia.org/wiki/Liste_over_Norges_fiskeriministre">Wikipedia</a> to learn about them.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There are no ministers younger than 30 or older than 69 in <code>who_gov_norway_ministers</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Note that since our data starts in 1966 and some of the people in government in the 1960s and 1970s may also have been in government before the start of our data, this variable will be somewhat inaccurate at the beginning of the time series.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>If we are to do this for a proper research project such as an MA thesis, we would have wanted to use a complete dataset on all Norwegian Ministers. In fact Martin <span class="citation" data-cites="soyland2017survival">Søyland (<a href="#ref-soyland2017survival" role="doc-biblioref">2017</a>)</span> did just that for his MA thesis which he later published as an article. His data are available <a href="https://github.com/martigso/ministersNor">here</a>. WhoGov is updated annually and sometimes ministers are replaced more frequently. For instance, Kåre Gjønnes, which we recoded above, was not just Minister of Agriculture from 1997 to 2000. He was also Minister of Nordic Cooperation from January to March 2000. Because he never held this position in July, it is, however, not registered in the WhoGov dataset. WhoGov arguably makes up for omissions such as these by offering a very impressive coverage of most countries in the world over a long time period, making it possible, for instance, to <a href="https://doi.org/10.1017/S000305542300062X">study female access to cabinets across the world <span class="citation" data-cites="nyrup2023consolidating">Nyrup, Yamagishi, and Bramwell (<span>2023</span>)</span></a>. But if you do a study only on a single country, want to do like <span class="citation" data-cites="soyland2017survival">Søyland (<a href="#ref-soyland2017survival" role="doc-biblioref">2017</a>)</span> and collect data on all the ministers!<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>We grabbed this data from the Norwegian parliament’s website using the R package <code>stortingscrape</code> developed by <span class="citation" data-cites="soyland2021stortingscrape">Søyland (<a href="#ref-soyland2021stortingscrape" role="doc-biblioref">2021</a>)</span>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>When coding the <code>period_id</code>, we keep in mind that each legislative period starts at the beginning of October (at least since 1962), while WhoGov is updated each July.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Wrangling/tidy_data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Tidy Data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center"><img src="..\pics/uio-logo-white.png" class="img-fluid" width="150"></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>