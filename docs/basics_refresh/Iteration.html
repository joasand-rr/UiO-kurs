<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title> | STV4030A - Iteration</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../basics_refresh/encoding.html" rel="next">
<link href="../basics_refresh/Functions.html" rel="prev">
<link href="..//pics/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title"><img src="../pics/uio-logo-white.png" class="img-fluid" width="150"> | STV4030A</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../basics_refresh/R_refresher.html">Working in R</a></li><li class="breadcrumb-item"><a href="../basics_refresh/Iteration.html">Iteration</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.uio.no/oyvinsti/STV4030A">
            Source code
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.uio.no/oyvinsti/STV4030A/issues">
            Report an error
            </a>
          </li>
      </ul>
    </div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Working in R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/R_refresher.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R refresher</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/Beyond_the_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Beyond the basics: functions and iteration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/Functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writing your own functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/Iteration.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Iteration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics_refresh/encoding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Locales and encoding</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Quarto documents</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Quarto_documents/writing_quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writing Quarto documents</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Quarto_documents/producing_tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Producing Tables from R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Wrangling/tidy_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidy Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Wrangling/wrangling_in_dplyr_and_tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wrangling in <code>dplyr</code> and <code>tidyr</code></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Visualization/data_viz_in_ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Visualization in <code>ggplot2</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Visualization/data_viz_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Examples of different types of data visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Visualization/data_viz_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualizing regression models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Visualization/data_viz_model_predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualizing quantities of interest based on regression models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Text data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/text_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Political Text as Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/read_texts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reading Texts into R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regular expressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/extracting_data_from_texts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extracting data from texts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_data/preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preprocessing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Data gathering</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_gather/webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Webscraping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_gather/apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">APIs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Spatial data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial_data/what_is_spatial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What is spatial data?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial_data/reading_spatial_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reading spatial data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial_data/spatial_joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial joins</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial_data/basic_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating maps</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#for-loops" id="toc-for-loops" class="nav-link" data-scroll-target="#for-loops"><code>for</code>-loops</a></li>
  <li><a href="#the-apply-family-of-functions" id="toc-the-apply-family-of-functions" class="nav-link" data-scroll-target="#the-apply-family-of-functions">The <code>apply()</code> family of functions</a></li>
  <li><a href="#the-purrr-package" id="toc-the-purrr-package" class="nav-link" data-scroll-target="#the-purrr-package">The <code>purrr</code> package</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Iteration</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="motivation" class="level1">
<h1>Motivation</h1>
<p>We often need to apply the same functions to multiple values. Most of our time working in R, we will do this without giving a second thought as functions are <em>vectorized</em>: when we apply the function to a vector it will actually apply the function to each element of the vector.</p>
<p>For instance, let’s say we have this vector which consists of all integers starting at 1 and ending at 10000:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s say we want to take the <a href="https://en.wikipedia.org/wiki/Natural_logarithm">natural logarithm</a> of each of these numbers. We would simply run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>log_numbers <span class="ot">&lt;-</span> <span class="fu">log</span>(numbers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function <code>log()</code> is vectorized so it operates on each element of <code>number</code> and creates a new vector, which we decided to call <code>log_numbers</code>. This feature is an important strength of R as it makes our code fast to write and run and easy to both write and read.</p>
<p>Alas, sometimes we still need to repeatedly run the same functions.</p>
<p>Consider, for instance, the function <code>read_dta()</code> from the package <code>haven</code>. This function takes a single Stata (<code>.dta</code>) file and loads it to R as <code>data.frame</code>. But what if we have many <code>.dta</code>-files?</p>
<p>In the directory “..data/wealth_and_democracy” we have 60 <code>.dta</code>-files each containing data for one of the years in the period 1789 to 1848. Each file contains all countries included in the Historical Varieties of Democracy data <span class="citation" data-cites="knutsen2019introducing">(<a href="#ref-knutsen2019introducing" role="doc-biblioref">Knutsen et al. 2019</a>)</span> for that particular year, the country’s score on the polyarchy index in that year, and an estimate of its gross domestic product per capita. We can load the file for 1789 like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>countries_1789 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"../data/wealth_and_democracy/wealth_and_democracy_in_1789.dta"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(countries_1789)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  country_name country_id  year v2x_polyarchy e_gdppc
  &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;
1 Mexico                3  1789         0.028    1.35
2 Sweden                5  1789         0.188    1.69
3 Japan                 9  1789         0.026    1.21
4 Russia               11  1789         0.029    1.58
5 Egypt                13  1789         0.033    1.12
6 Poland               17  1789         0.199    1.00</code></pre>
</div>
</div>
<p>It is also straightforward to get a vector of all the file names in the directory using the <code>dir()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>file_names <span class="ot">&lt;-</span> <span class="fu">dir</span>(<span class="st">"../data/wealth_and_democracy/"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(file_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "wealth_and_democracy_in_1789.dta" "wealth_and_democracy_in_1790.dta"
 [3] "wealth_and_democracy_in_1791.dta" "wealth_and_democracy_in_1792.dta"
 [5] "wealth_and_democracy_in_1793.dta" "wealth_and_democracy_in_1794.dta"
 [7] "wealth_and_democracy_in_1795.dta" "wealth_and_democracy_in_1796.dta"
 [9] "wealth_and_democracy_in_1797.dta" "wealth_and_democracy_in_1798.dta"
[11] "wealth_and_democracy_in_1799.dta" "wealth_and_democracy_in_1800.dta"
[13] "wealth_and_democracy_in_1801.dta" "wealth_and_democracy_in_1802.dta"
[15] "wealth_and_democracy_in_1803.dta" "wealth_and_democracy_in_1804.dta"
[17] "wealth_and_democracy_in_1805.dta" "wealth_and_democracy_in_1806.dta"
[19] "wealth_and_democracy_in_1807.dta" "wealth_and_democracy_in_1808.dta"
[21] "wealth_and_democracy_in_1809.dta" "wealth_and_democracy_in_1810.dta"
[23] "wealth_and_democracy_in_1811.dta" "wealth_and_democracy_in_1812.dta"
[25] "wealth_and_democracy_in_1813.dta" "wealth_and_democracy_in_1814.dta"
[27] "wealth_and_democracy_in_1815.dta" "wealth_and_democracy_in_1816.dta"
[29] "wealth_and_democracy_in_1817.dta" "wealth_and_democracy_in_1818.dta"
[31] "wealth_and_democracy_in_1819.dta" "wealth_and_democracy_in_1820.dta"
[33] "wealth_and_democracy_in_1821.dta" "wealth_and_democracy_in_1822.dta"
[35] "wealth_and_democracy_in_1823.dta" "wealth_and_democracy_in_1824.dta"
[37] "wealth_and_democracy_in_1825.dta" "wealth_and_democracy_in_1826.dta"
[39] "wealth_and_democracy_in_1827.dta" "wealth_and_democracy_in_1828.dta"
[41] "wealth_and_democracy_in_1829.dta" "wealth_and_democracy_in_1830.dta"
[43] "wealth_and_democracy_in_1831.dta" "wealth_and_democracy_in_1832.dta"
[45] "wealth_and_democracy_in_1833.dta" "wealth_and_democracy_in_1834.dta"
[47] "wealth_and_democracy_in_1835.dta" "wealth_and_democracy_in_1836.dta"
[49] "wealth_and_democracy_in_1837.dta" "wealth_and_democracy_in_1838.dta"
[51] "wealth_and_democracy_in_1839.dta" "wealth_and_democracy_in_1840.dta"
[53] "wealth_and_democracy_in_1841.dta" "wealth_and_democracy_in_1842.dta"
[55] "wealth_and_democracy_in_1843.dta" "wealth_and_democracy_in_1844.dta"
[57] "wealth_and_democracy_in_1845.dta" "wealth_and_democracy_in_1846.dta"
[59] "wealth_and_democracy_in_1847.dta" "wealth_and_democracy_in_1848.dta"</code></pre>
</div>
</div>
<p>However, loading all these files is not as straightforward. If we try to read multiple <code>.dta</code>-files at once using</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-5-1" class="code-annotation-target"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"../data/wealth_and_democracy/"</span>, file_names, <span class="at">sep =</span> <span class="st">""</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-5-2" class="code-annotation-target"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a>all_years <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(paths)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="1" data-code-lines="1">Here we use <code>paste()</code> to create a vector with the paths to all the different <code>.dta</code>-files</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="2" data-code-lines="2">We attempt to load all the files in one go, but this fails!</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in `read_dta()`:
! This kind of input is not handled.</code></pre>
</div>
</div>
<p>How then can we load all the different files? We could start with the code we used to load the file for 1789, copy-paste it 60 times, and edit the different file names. This process is, however, both cumbersome and error prone.</p>
<p>A much better would be to use one of the different <em>iteration</em> tools in R.</p>
</section>
<section id="for-loops" class="level1">
<h1><code>for</code>-loops</h1>
<p>A <code>for</code>-loop does the operation(s) you tell it to do <strong><em>for</em></strong> all the elements in a vector. For instance, we can write a <code>for</code>-loop to print all the integers between -5 and 5:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-6"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-6-1" class="code-annotation-target"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>){</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-6-2" class="code-annotation-target"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-6-3" class="code-annotation-target"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a>}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="1" data-code-lines="1">We write that we want to something <code>for</code> all elements <code>i</code> in the vector <code>-5:5</code>. After the curly bracket (<code>{</code>), we can start defining what to do.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="2" data-code-lines="2">Here we define what to do. We simply want to <code>print(i)</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-annotation="3" data-code-lines="3">The curly bracket closes the loop, meaning that we are done defining what should happen to each element i.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -5
[1] -4
[1] -3
[1] -2
[1] -1
[1] 0
[1] 1
[1] 2
[1] 3
[1] 4
[1] 5</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You don’t have loop over <code>i</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is nothing magical about <code>i</code>, we could have just as well written:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(number <span class="cf">in</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>){ </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(number) </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -5
[1] -4
[1] -3
[1] -2
[1] -1
[1] 0
[1] 1
[1] 2
[1] 3
[1] 4
[1] 5</code></pre>
</div>
</div>
<p>or whatever we find intuitive. Using <code>i</code> is just a convention.</p>
</div>
</div>
<p>Now that we know the basic of <code>for</code>-loops, let’s see if we can write a loop that loads all our 60 <code>.dta</code>-files. To that we need a vector with the paths to all the files. We already have the <code>paths</code> vector, which we can use. A loop that only loads the files would then look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> paths){</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-7-2" class="code-annotation-target"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_dta</span>(i)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a>}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="1" data-code-lines="1">For each element <code>i</code> in <code>paths</code>,</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="2" data-code-lines="2">read the <code>.dta</code>-file for the element <code>i</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-annotation="3" data-code-lines="3">That’s it. Go back to the top and do the next element <code>i</code> if there are more of them.</span>
</dd>
</dl>
</div>
</div>
<p>Of course, just loading all the files is not terribly useful unless we also assign them to objects. For that we we will need a vector of object names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>object_names <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"countries"</span>, <span class="dv">1789</span><span class="sc">:</span><span class="dv">1848</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(object_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "countries_1789" "countries_1790" "countries_1791" "countries_1792"
 [5] "countries_1793" "countries_1794" "countries_1795" "countries_1796"
 [9] "countries_1797" "countries_1798" "countries_1799" "countries_1800"
[13] "countries_1801" "countries_1802" "countries_1803" "countries_1804"
[17] "countries_1805" "countries_1806" "countries_1807" "countries_1808"
[21] "countries_1809" "countries_1810" "countries_1811" "countries_1812"
[25] "countries_1813" "countries_1814" "countries_1815" "countries_1816"
[29] "countries_1817" "countries_1818" "countries_1819" "countries_1820"
[33] "countries_1821" "countries_1822" "countries_1823" "countries_1824"
[37] "countries_1825" "countries_1826" "countries_1827" "countries_1828"
[41] "countries_1829" "countries_1830" "countries_1831" "countries_1832"
[45] "countries_1833" "countries_1834" "countries_1835" "countries_1836"
[49] "countries_1837" "countries_1838" "countries_1839" "countries_1840"
[53] "countries_1841" "countries_1842" "countries_1843" "countries_1844"
[57] "countries_1845" "countries_1846" "countries_1847" "countries_1848"</code></pre>
</div>
</div>
<p>Since <code>object_names</code> is a character vector, we cannot use <code>&lt;-</code> to assign each file to the right object in the loop. Instead we will use the function <code>assign()</code> which takes an object name, <code>x</code>, in the form of a character string and a <code>value</code>. It will then assign whatever is in <code>value</code> to whatever name is in <code>x</code> in the global environment.</p>
<p>Since we are now working with two vectors (<code>paths</code> and <code>object_names</code>) in the loop, we will loop over integer from 1 to their <code>length()</code> (which should be 60 for both vectors) and use indexing to grab the right element in each iteration of the loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(paths)){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="at">x =</span> object_names[i], </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> <span class="fu">read_dta</span>(paths[i]))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When running the loop above, 60 different datasets are loaded and assigned to objects in our global environment. For instance, we will now have an object called <code>countries_1802</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(countries_1802)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  country_name country_id  year v2x_polyarchy e_gdppc
  &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;
1 Mexico                3  1802         0.028    1.32
2 Sweden                5  1802         0.189    1.49
3 Switzerland           6  1802         0.188    2.01
4 Japan                 9  1802         0.028    1.26
5 Russia               11  1802         0.02     1.58
6 Egypt                13  1802         0.032    1.08</code></pre>
</div>
</div>
<p>We probably didn’t load all these datasets just for the fun of it.</p>
<p>Perhaps our reason for loading all these different <code>.dta</code> files was that we want to estimate linear regression model for the bivarate relationship between wealth (as captured by log(gross domestic product per capita)) and democracy (as captured by the polyarchy index)). We will consider wealth as the independent variable and democracy as the independent variable (although this relationship could arguably also work in the opposite direction). For each regression we want to save the coefficient for log(gross domestic product per capita) and its standard error.</p>
<p>Again, we don’t want to write out the code for a regression model 60 times only changing which dataset it is estimated on. It would be great if we also could estimate model and retrieve the coefficient of interest inside the loop. Can we?</p>
<p>A good way to start is to write out the code for what we would like to do for a single dataset. Let’s do the year 1814:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-11-1" class="code-annotation-target"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-11-2" class="code-annotation-target"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"../data/wealth_and_democracy/wealth_and_democracy_in_1814.dta"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-11-3" class="code-annotation-target"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a>regression_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(v2x_polyarchy <span class="sc">~</span> <span class="fu">log</span>(e_gdppc), <span class="at">data =</span> dataset)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-11-4" class="code-annotation-target"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(regression_model)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-11-5" class="code-annotation-target"><a href="#annotated-cell-11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(regression_model)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"std.error"</span>)]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-annotation="1" data-code-lines="1">The <code>broom</code> package is great for converting the objects of regression models into <code>data.frame</code>s that are easy to work with in R</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-annotation="2" data-code-lines="2">We load the data</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-annotation="3" data-code-lines="3">We estimate the model</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-annotation="4" data-code-lines="4">Just to illustrate: <code>tidy()</code> from <code>broom</code> produces a nice little <code>data.frame</code> (or technically, a <code>tibble</code>, but that’s just a type of <code>data.frame</code>) based on our model. This <code>data.frame</code> is easy to work with.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-annotation="5" data-code-lines="5">We can subset the <code>data.frame</code> produced by <code>tidy()</code> from <code>broom</code> to grab the coefficient and standard error we are interested in.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term         estimate std.error statistic p.value
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)    0.0433    0.0154      2.80 0.00875
2 log(e_gdppc)   0.109     0.0309      3.52 0.00141
# A tibble: 1 × 2
  estimate std.error
     &lt;dbl&gt;     &lt;dbl&gt;
1    0.109    0.0309</code></pre>
</div>
</div>
<p>A next useful step is to see if we can rewrite this code just from the <code>paths</code> vector and save the result in a convenient way.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-12-1" class="code-annotation-target"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coefficient =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="fu">length</span>(paths)),</span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">standard_error =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="fu">length</span>(paths)))</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-12-3" class="code-annotation-target"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(paths[<span class="dv">26</span>])</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-12-4" class="code-annotation-target"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a>regression_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(v2x_polyarchy <span class="sc">~</span> <span class="fu">log</span>(e_gdppc), <span class="at">data =</span> dataset)</span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-12-6" class="code-annotation-target"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a>estimates[<span class="dv">26</span>,] <span class="ot">&lt;-</span> <span class="fu">tidy</span>(regression_model)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"std.error"</span>)]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-annotation="1" data-code-lines="1,2">We create a <code>data.frame</code> to store the results in. We want one row per element in <code>paths</code> so we use <code>length(path)</code> to determine the number of rows. We want to variables <code>coefficient</code> and <code>standard_error</code>. We don’t know what values are yet (that’s what we are trying to figure out!), so we just fill the <code>data.frame</code> with <code>NA</code>s for now.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-annotation="2" data-code-lines="3">We load <code>paths[26]</code>, i.e.&nbsp;the 26th element of <code>paths</code> and assign it to <code>dataset</code></span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-annotation="3" data-code-lines="4">We estimate the regression model, using <code>dataset</code> as the data.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-annotation="4" data-code-lines="6">We store the coefficient and standard error for <code>log(e_gdppc)</code> to the 26th row of <code>estimates</code>.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-13-1" class="code-annotation-target"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(estimates)){</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-13-2" class="code-annotation-target"><a href="#annotated-cell-13-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(paths[i])</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-13-3" class="code-annotation-target"><a href="#annotated-cell-13-3" aria-hidden="true" tabindex="-1"></a>  regression_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(v2x_polyarchy <span class="sc">~</span> <span class="fu">log</span>(e_gdppc), <span class="at">data =</span> dataset)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-13-4" class="code-annotation-target"><a href="#annotated-cell-13-4" aria-hidden="true" tabindex="-1"></a>  estimates[i,] <span class="ot">&lt;-</span> <span class="fu">tidy</span>(regression_model)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"std.error"</span>)]</span>
<span id="annotated-cell-13-5"><a href="#annotated-cell-13-5" aria-hidden="true" tabindex="-1"></a>}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-annotation="1" data-code-lines="1">We loop over all the numbers from 1 to the number of rows in <code>estimates</code> (we could also have used the length of <code>paths</code>).</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-annotation="2" data-code-lines="2">We load the element <code>i</code> of <code>paths</code> and save it to <code>dataset</code>. We did this for every iteration, so we will continuously overwrite <code>dataset</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-annotation="3" data-code-lines="3">We estimate the model using whatever data is currently stored as <code>dataset</code> and assign it <code>regression_model</code>. <code>regression_model</code> will also be overwritten for each iteration.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-annotation="4" data-code-lines="4">Finally we save the coefficient and standard error to the <code>i</code>th row of <code>estimates</code>. Because <code>i</code> is changing for each iteration. These results will <strong>not</strong> be overwritten. Instead they will be saved in <code>estimates</code></span>
</dd>
</dl>
</div>
</div>
<p>The first rows of <code>estimates</code> look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(estimates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  coefficient standard_error
1  0.07566119     0.04031438
2  0.07796730     0.04090374
3  0.07859954     0.04003433
4  0.07971598     0.04083772
5  0.08638019     0.03958585
6  0.08455238     0.04014866</code></pre>
</div>
</div>
<p>We can now use this <code>data.frame</code> to, let’s say, make a <a href="https://github.com/MatthewBJane/theme_barbie/">Barbie-themed</a> <span class="citation" data-cites="JaneBarbie2023">(<a href="#ref-JaneBarbie2023" role="doc-biblioref">Jané 2023</a>)</span> coefficient plot displaying the coefficient and 95% confidence interval for each year from 1789 to 1848. <a href="https://pages.github.uio.no/oyvinsti/STV4030A/Visualization/data_viz_in_ggplot.html">We will cover how to make such plots later</a>, so for now we have hidden the code (if you wish, you may, however, click on the “Code” button to display the code for the plot).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ThemePark)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>estimates<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">1789</span><span class="sc">:</span><span class="dv">1848</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>estimates<span class="sc">$</span>lower <span class="ot">&lt;-</span> estimates<span class="sc">$</span>coefficient <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> estimates<span class="sc">$</span>standard_error</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>estimates<span class="sc">$</span>upper <span class="ot">&lt;-</span> estimates<span class="sc">$</span>coefficient <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> estimates<span class="sc">$</span>standard_error</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(estimates, </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> coefficient, </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> lower, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> upper, </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> year))<span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>()<span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Coefficient for log(gdp per capita)"</span>)<span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Year"</span>)<span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.10</span>, <span class="fl">0.25</span>)<span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_barbie</span>(<span class="at">barbie_font =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Iteration_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="the-apply-family-of-functions" class="level1">
<h1>The <code>apply()</code> family of functions</h1>
<p><code>for</code>-loops run relatively slowly in R. This doesn’t matter if you are only looping over a few element and each step doesn’t take a lot of time for your computer to complete, but <code>for</code>-loops don’t scale all that well.</p>
<p>What is R is good at is applying functions to vectors. So, it will be useful to consider alternatives to <code>for</code>-loops that play on this strength:</p>
<p>One such alternative is the <code>apply</code> family of function, which is available in base R. The function <code>lapply()</code> will take a list or vector, apply some function to all elements in that list or vector, and return a list with the results.</p>
<p>So let’s say we again have the vector <code>-5:5</code> consisting all integers from -5 to 5. We want to divide all of them by 2. Using <code>lapply()</code> we may:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="at">X =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){x<span class="sc">/</span><span class="dv">2</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] -2.5

[[2]]
[1] -2

[[3]]
[1] -1.5

[[4]]
[1] -1

[[5]]
[1] -0.5

[[6]]
[1] 0

[[7]]
[1] 0.5

[[8]]
[1] 1

[[9]]
[1] 1.5

[[10]]
[1] 2

[[11]]
[1] 2.5</code></pre>
</div>
</div>
<p>The result will be a list of the same length as <code>-5:5</code> and each element will contain the corresponding element in the original vector divided by 2. On its own, this is not terribly impressive, we might as well have run <code>-5:5/2</code>. But just like for a <code>for</code>-loop the advantage is found in how we can extend the logic to other types of inputs.</p>
<p>We could for write a function that given a path, will load a <code>.dta</code>-file found in that path, estimate a regression model with <code>v2x_polyarchy</code> as the dependent variable and <code>log(e_gdppc)</code> and extract the coefficient and standard error for <code>log(e_gdppc)</code>. We can <code>lapply</code> this function to all the elements of our vector <code>paths</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-17-1" class="code-annotation-target"><a href="#annotated-cell-17-1" aria-hidden="true" tabindex="-1"></a>coefficients_and_standard_errors <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> paths,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-17-2" class="code-annotation-target"><a href="#annotated-cell-17-2" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-17-3" class="code-annotation-target"><a href="#annotated-cell-17-3" aria-hidden="true" tabindex="-1"></a>                                             dataset <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(x)</span>
<span id="annotated-cell-17-4"><a href="#annotated-cell-17-4" aria-hidden="true" tabindex="-1"></a>                                             regression_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(v2x_polyarchy <span class="sc">~</span></span>
<span id="annotated-cell-17-5"><a href="#annotated-cell-17-5" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="fu">log</span>(e_gdppc), <span class="at">data =</span> dataset)</span>
<span id="annotated-cell-17-6"><a href="#annotated-cell-17-6" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">tidy</span>(regression_model)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"std.error"</span>)]</span>
<span id="annotated-cell-17-7"><a href="#annotated-cell-17-7" aria-hidden="true" tabindex="-1"></a>                                           })</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-annotation="1" data-code-lines="1">We need to specify the argument <code>X</code> (notice the upper case X), which should be a list or atomic vector to apply the function to.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-annotation="2" data-code-lines="2">We need to specify the argument <code>FUN</code> we specify the function that should be applied to all elements in <code>X</code>. We can define our own function, which is what we use here (<a href="https://pages.github.uio.no/oyvinsti/STV4030A/basics_refresh/Functions.html">using the skills we already picked up here</a>)</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-annotation="3" data-code-lines="3,4,5,6">Our function, takes the argument <code>x</code> and for each <code>x</code> loads a dataset using <code>read_dta()</code>, estimates or regression model on that dataset using <code>lm()</code>, extracts the coefficient of interest using <code>tidy()</code> from <code>broom</code> and some basic subsetting.</span>
</dd>
</dl>
</div>
</div>
<p>The object <code>coefficients_and_standard_errors</code> is a list and each element of the list is a <code>data.frame</code> with the one coefficient and one standard error. For instance, we will find our coefficient and standard error for the year 1814 in the 26th element like before:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>coefficients_and_standard_errors[<span class="dv">26</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 1 × 2
  estimate std.error
     &lt;dbl&gt;     &lt;dbl&gt;
1    0.109    0.0309</code></pre>
</div>
</div>
<p>Using the functions <code>do.call()</code> and <code>rbind()</code>, we may combine all the elements of list together in one <code>data.frame</code>. <code>do.call()</code> takes two functions: a function and a list of elements to apply the function to. Here we will supply the function <code>rbind</code> that binds different <code>data.frames</code> together by the rows and our list (<code>coefficients_and_standard_errors</code>) of <code>data.frame</code>s we would like to combine:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-19"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-19-1" class="code-annotation-target"><a href="#annotated-cell-19-1" aria-hidden="true" tabindex="-1"></a>estimates2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-19-2" class="code-annotation-target"><a href="#annotated-cell-19-2" aria-hidden="true" tabindex="-1"></a>                       coefficients_and_standard_errors)</span>
<span id="annotated-cell-19-3"><a href="#annotated-cell-19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-19-4"><a href="#annotated-cell-19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(estimates2)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-19" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-annotation="1" data-code-lines="1">First we specify what function should applied. Here we use <code>rbind()</code> which binds <code>data.frame</code>s together. <a href="https://pages.github.uio.no/oyvinsti/STV4030A/Wrangling/wrangling_in_dplyr_and_tidyr.html#combining-datasets-with-dplyr">It is the base R equivalent of the <code>dplyr::bind_rows</code> which we will spend more time on later.</a></span>
</dd>
<dt data-target-cell="annotated-cell-19" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-annotation="2" data-code-lines="2">We then specify the list of arguments to the function (here <code>rbind</code>). Since each element in the list is a <code>data.frame</code>, what we are doing here is to tell R to bind all these <code>data.frame</code>s together.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  estimate std.error
     &lt;dbl&gt;     &lt;dbl&gt;
1   0.0757    0.0403
2   0.0780    0.0409
3   0.0786    0.0400
4   0.0797    0.0408
5   0.0864    0.0396
6   0.0846    0.0401</code></pre>
</div>
</div>
<p>Thus, we managed to do exactly what we did in the <code>for</code>-loop above using <code>lapply()</code>. This is great news as using the <code>apply</code> functions can be much more efficient than writing <code>for</code>-loops in R.</p>
<p><code>lapply()</code> is not the only <code>apply()</code> function. <code>apply</code> will take a <code>data.frame</code> or <code>matrix</code> and apply some function across the rows or across the columns. This can be useful for instance when computing summary statistics. Let’s calculate the <code>mean()</code> for both <code>v2x_polyarchy</code> and <code>e_gdppc</code> in <code>countries_1814</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-20"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-20-1" class="code-annotation-target"><a href="#annotated-cell-20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(countries_1814[,<span class="fu">c</span>(<span class="st">"v2x_polyarchy"</span>, <span class="st">"e_gdppc"</span>)],</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-20-2" class="code-annotation-target"><a href="#annotated-cell-20-2" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-20-3" class="code-annotation-target"><a href="#annotated-cell-20-3" aria-hidden="true" tabindex="-1"></a>      mean)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-annotation="1" data-code-lines="1">give <code>apply()</code> a <code>data.frame</code> or <code>matrix</code>. Here we subset <code>countries_1814</code> to only contain the variables <code>v2x_polyarchy</code> and <code>e_gdppc</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-annotation="2" data-code-lines="2">We specify 1 if we want the function to be done by the rows and 2 if it should be done by columns. Here we specify 2 because we want the <code>mean()</code> for each column</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-annotation="3" data-code-lines="3">Finally we specify the function we want to <code>apply()</code>, here we use <code>mean()</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>v2x_polyarchy       e_gdppc 
     0.074000      1.447563 </code></pre>
</div>
</div>
<p><code>sapply()</code> is like <code>lapply()</code> but will simplify the result to be an atomic vector or a matrix instead of a list. Thus, if we had written the code dividing all the integers in <code>-5:5</code> by 2 using <code>sapply()</code> instead of <code>lapply()</code>, we would have produced a nice numeric vector instead of a list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="at">X =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){x<span class="sc">/</span><span class="dv">2</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -2.5 -2.0 -1.5 -1.0 -0.5  0.0  0.5  1.0  1.5  2.0  2.5</code></pre>
</div>
</div>
<p>If our goal is to produce a variable for a <code>data.frame</code>, making a vector with <code>sapply()</code> is often better than making a list with <code>lapply()</code>.</p>
</section>
<section id="the-purrr-package" class="level1">
<h1>The <code>purrr</code> package</h1>
<p>The <a href="https://purrr.tidyverse.org/reference/map.html"><code>purrr</code> package</a> provides an even more comprehensive set of tools for using functions to do various iterative tasks in R (and thus avoiding <code>for</code>-loops).</p>
<p>The workhorse function of <code>purrr</code> is the <code>map()</code>-function which works very similarly to the <code>apply</code>-functions in base R. <code>map()</code> takes the argument <code>.x</code> which should be provided a list or atomic vector and <code>.f</code> which should be function. The function will be applied to each element of <code>.x</code> and <code>map()</code> will retun a list with the results.</p>
<p>Let’s try to take all the integers in <code>-5:5</code> and divide by 2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-22"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-22" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-22-1" class="code-annotation-target"><a href="#annotated-cell-22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-22" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-22-2" class="code-annotation-target"><a href="#annotated-cell-22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="at">.x =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-22" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-22-3" class="code-annotation-target"><a href="#annotated-cell-22-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="cf">function</span>(x){</span>
<span id="annotated-cell-22-4"><a href="#annotated-cell-22-4" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">/</span><span class="dv">2</span>}</span>
<span id="annotated-cell-22-5"><a href="#annotated-cell-22-5" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-22" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-annotation="1" data-code-lines="1">Remember to load the <code>purrr</code> package!</span>
</dd>
<dt data-target-cell="annotated-cell-22" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-annotation="2" data-code-lines="2">Supply your vector to <code>.x</code>!</span>
</dd>
<dt data-target-cell="annotated-cell-22" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-annotation="3" data-code-lines="3,4">Supply your function to <code>.f</code>. You can define your own function as we do here or provide the name of a function.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] -2.5

[[2]]
[1] -2

[[3]]
[1] -1.5

[[4]]
[1] -1

[[5]]
[1] -0.5

[[6]]
[1] 0

[[7]]
[1] 0.5

[[8]]
[1] 1

[[9]]
[1] 1.5

[[10]]
[1] 2

[[11]]
[1] 2.5</code></pre>
</div>
</div>
<p>It is sometimes inconvenient that <code>map()</code> returns a list. Often we want an atomic vector (like an numeric or character vector) instead. <code>purrr</code> also has a series of <code>map_*</code>-functions that return specific types of vectors. For instance, <code>map_dbl</code> will return a numeric vector (the numeric data type is also called “double”):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(<span class="at">.x =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="cf">function</span>(x){</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">/</span><span class="dv">2</span>}</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -2.5 -2.0 -1.5 -1.0 -0.5  0.0  0.5  1.0  1.5  2.0  2.5</code></pre>
</div>
</div>
<p>Similarly, <code>map_chr</code> will return a character vector (but <code>purrr</code> doesn’t like it when we implicitly coerce a numeric vector to a character vector and will spit out a warning to complain) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_chr</span>(<span class="at">.x =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="cf">function</span>(x){</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">/</span><span class="dv">2</span>}</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Automatic coercion from double to character was deprecated in purrr 1.0.0.
ℹ Please use an explicit call to `as.character()` within `map_chr()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "-2.500000" "-2.000000" "-1.500000" "-1.000000" "-0.500000" "0.000000" 
 [7] "0.500000"  "1.000000"  "1.500000"  "2.000000"  "2.500000" </code></pre>
</div>
</div>
<p>The function <code>map_vec</code> will work with any kind of vector and return a vector of the same data type as it was supplied.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_vec</span>(<span class="at">.x =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="cf">function</span>(x){</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">/</span><span class="dv">2</span>}</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -2.5 -2.0 -1.5 -1.0 -0.5  0.0  0.5  1.0  1.5  2.0  2.5</code></pre>
</div>
</div>
<p>So can we load our datasets and estimate our regression models using <code>purrr</code> Of course we can! Using only map, we can create a list with all the coefficients and standard errors (just like we did with <code>lapply()</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-26"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-26-1" class="code-annotation-target"><a href="#annotated-cell-26-1" aria-hidden="true" tabindex="-1"></a>coefficients_and_standard_errors_from_map <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> paths,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-26-2" class="code-annotation-target"><a href="#annotated-cell-26-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">.f =</span> <span class="cf">function</span>(x){</span>
<span id="annotated-cell-26-3"><a href="#annotated-cell-26-3" aria-hidden="true" tabindex="-1"></a>                                             dataset <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(x)</span>
<span id="annotated-cell-26-4"><a href="#annotated-cell-26-4" aria-hidden="true" tabindex="-1"></a>                                             regression_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(v2x_polyarchy <span class="sc">~</span></span>
<span id="annotated-cell-26-5"><a href="#annotated-cell-26-5" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="fu">log</span>(e_gdppc), <span class="at">data =</span> dataset)</span>
<span id="annotated-cell-26-6"><a href="#annotated-cell-26-6" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">tidy</span>(regression_model)[<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"std.error"</span>)]</span>
<span id="annotated-cell-26-7"><a href="#annotated-cell-26-7" aria-hidden="true" tabindex="-1"></a>                                           })</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-26" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-annotation="1" data-code-lines="1">We supply our <code>paths</code> vector to <code>.x</code></span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-annotation="2" data-code-lines="2,3,4,5,6">We supply our function for loading the data, estimating the model, and retrieving the output we care about to <code>.f</code> <code>coefficients_and_standard_errors_from_map</code> is a list with each element containing a <code>data.frame</code> the coefficient and standard error for one of the 60 models we just ran.</span>
</dd>
</dl>
</div>
</div>
<p>The <code>purrr</code> package also contains a set of functions for working with the lists that we will tend to produce when using <code>map()</code>. For instance, <code>reduce()</code> will combine all the elements of a list you provide (to its <code>.x</code> argument) using some function (that you supply to its <code>.f</code> argument). So, we can use <code>reduce()</code> together with <code>rbind()</code> to produce a single <code>data.frame</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-27"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-27-1" class="code-annotation-target"><a href="#annotated-cell-27-1" aria-hidden="true" tabindex="-1"></a>coefficients_and_standard_errors_from_map <span class="ot">&lt;-</span> <span class="fu">reduce</span>(<span class="at">.x =</span> coefficients_and_standard_errors_from_map,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-27-2" class="code-annotation-target"><a href="#annotated-cell-27-2" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">.f =</span> rbind)</span>
<span id="annotated-cell-27-3"><a href="#annotated-cell-27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-27-4"><a href="#annotated-cell-27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coefficients_and_standard_errors_from_map)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-27" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-annotation="1" data-code-lines="1">We use <code>reduce()</code> to combine all the elements of a list into a single value. We supply the list to <code>.x</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-annotation="2" data-code-lines="2">And we supply the function we will use to combine the elements to <code>.f</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  estimate std.error
     &lt;dbl&gt;     &lt;dbl&gt;
1   0.0757    0.0403
2   0.0780    0.0409
3   0.0786    0.0400
4   0.0797    0.0408
5   0.0864    0.0396
6   0.0846    0.0401</code></pre>
</div>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-JaneBarbie2023" class="csl-entry" role="listitem">
Jané, Matthew B. 2023. <span>“Theme_park: Popular Culture <span class="nocase">ggplot</span> Themes.”</span> <a href="https://github.com/MatthewBJane/theme_park">https://github.com/MatthewBJane/theme_park</a>.
</div>
<div id="ref-knutsen2019introducing" class="csl-entry" role="listitem">
Knutsen, Carl Henrik, Jan Teorell, Tore Wig, Agnes Cornell, John Gerring, Haakon Gjerløw, Svend-Erik Skaaning, et al. 2019. <span>“Introducing the Historical Varieties of Democracy Dataset: Political Institutions in the Long 19th Century.”</span> <em>Journal of Peace Research</em> 56 (3): 440–51.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../basics_refresh/Functions.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Writing your own functions</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../basics_refresh/encoding.html" class="pagination-link">
        <span class="nav-page-text">Locales and encoding</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center"><img src="../pics/uio-logo-white.png" class="img-fluid" width="150"></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>